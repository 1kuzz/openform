<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä–∞ –Ω–æ—É—Ç–±—É–∫–æ–≤</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      /* –ø–ª–∞–≤–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è —Ñ–æ–Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
      background: radial-gradient(circle at top, #e5f0ff 0%, #f3f4f6 45%, #f3f4f6 100%);
      color: #111827;
      /* —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –±–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
      font-size: 14px;
    }
    h1, h2, h3 { margin: 0 0 8px; }
    .page {
      max-width: 1280px;
      margin: 0 auto;
      padding: 20px;
      display: grid;
      grid-template-columns: 1.4fr 1fr;
      gap: 20px;
    }
    @media (max-width: 900px) {
      .page { grid-template-columns: 1fr; }
    }
    .card {
      background: #ffffff;
      border-radius: 16px;
      padding: 18px 20px;
      box-shadow: 0 12px 30px rgba(15,23,42,0.06);
    }
    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 8px;
    }
    .btn {
      border-radius: 999px;
      /* —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã –∫–Ω–æ–ø–æ–∫ –¥–ª—è –ª—É—á—à–µ–π –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ */
      padding: 8px 16px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .btn.primary {
      background: #2563eb;
      border-color: #2563eb;
      color: #ffffff;
    }
    .btn.danger {
      background: #fee2e2;
      border-color: #fecaca;
      color: #b91c1c;
    }
    /* —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –∫–Ω–æ–ø–æ–∫ */
    .btn.small { padding: 6px 12px; font-size: 12px; }
    .btn:disabled { opacity: 0.5; cursor: default; }
    /* –í–∏–¥–∏–º–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω–æ–≥–æ —Ñ–æ–∫—É—Å–∞ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
    .btn:focus {
      outline: 2px solid #2563eb;
      outline-offset: 2px;
    }

    .section-block {
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 10px 10px 12px;
      margin-bottom: 12px;
      background: #f9fafb;
    }
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }
    .section-header input {
      flex: 1;
    }
    .field-block {
      border-radius: 10px;
      border: 1px dashed #d1d5db;
      padding: 8px 8px 10px;
      margin-bottom: 8px;
      background: #ffffff;
    }
    .field-row {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 0.8fr) auto;
      gap: 6px;
      align-items: center;
      margin-bottom: 4px;
    }
    .field-row label {
      font-size: 11px;
      color: #6b7280;
      display: block;
      margin-bottom: 2px;
    }
    .field-row input[type="text"],
    .field-row input[type="number"],
    .field-row select {
      width: 100%;
      /* —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ */
      padding: 6px 10px;
      font-size: 12px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      outline: none;
    }
    .field-row input[type="text"]:focus,
    .field-row input[type="number"]:focus,
    .field-row select:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37,99,235,0.25);
      background: #ffffff;
    }
    .options-input {
      margin-top: 4px;
    }
    .options-input label {
      font-size: 11px;
      color: #6b7280;
      display: block;
      margin-bottom: 2px;
    }
    .options-input input,
    .options-input textarea,
    .options-input select {
      width: 100%;
      /* —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã –∏ —à—Ä–∏—Ñ—Ç –¥–ª—è –ø–æ–ª–µ–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
      padding: 6px 10px;
      font-size: 12px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      outline: none;
    }
    .options-input textarea { resize: vertical; min-height: 40px; }
    .options-input small {
      font-size: 10px;
      color: #9ca3af;
    }
    .note {
      /* —á—É—Ç—å —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —à—Ä–∏—Ñ—Ç —É –ø—Ä–∏–º–µ—á–∞–Ω–∏–π */
      font-size: 12px;
      color: #6b7280;
      margin-top: 4px;
    }
    /* –ü—Ä–µ–≤—å—é */
    #previewForm fieldset {
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 10px 12px 12px;
      margin-bottom: 10px;
    }
    #previewForm legend {
      font-size: 13px;
      font-weight: 600;
    }
    .preview-field {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .preview-field label {
      font-size: 12px;
    }
    .preview-field input,
    .preview-field select,
    .preview-field textarea {
      /* —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∏ –æ—Ç—Å—Ç—É–ø—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø—Ä–µ–≤—å—é */
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 7px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
    }
    .preview-field textarea { resize: vertical; min-height: 46px; }
    .preview-hint {
      /* —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —à—Ä–∏—Ñ—Ç —Ç–µ–∫—Å—Ç–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤ –ø—Ä–µ–≤—å—é */
      font-size: 12px;
      color: #6b7280;
    }

    /* Tabs and tab pages */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
    }
    .tab {
      border: 1px solid #d1d5db;
      border-bottom: none;
      background: #f3f4f6;
      padding: 6px 12px;
      border-radius: 8px 8px 0 0;
      cursor: pointer;
      font-size: 13px;
    }
    .tab.active {
      background: #ffffff;
      border-color: #2563eb;
      color: #2563eb;
      border-bottom: 1px solid #ffffff;
    }

    /* –í–∏–¥–∏–º–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ (–∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è) */
    .tab:focus {
      outline: 2px solid #2563eb;
      outline-offset: 2px;
    }

    /* –í–∫–ª–∞–¥–∫–∞ —Å –æ—à–∏–±–∫–∞–º–∏ */
    .tab.has-errors {
      border-color: #b91c1c !important;
      color: #b91c1c !important;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }

    /* –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ–Ω –∏ —Ä–∞–º–∫—É –∫ –ø–∞–Ω–µ–ª–∏ –≤–∫–ª–∞–¥–æ–∫, —á—Ç–æ–±—ã –≤–∏–∑—É–∞–ª—å–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º */
    .tabs {
      background: #ffffff;
      border: 1px solid #e5e7eb;
      border-bottom: none;
      border-radius: 12px 12px 0 0;
      padding-left: 10px;
    }
    .tabs .tab {
      padding: 8px 16px;
      font-size: 14px;
    }

    /* Layout for constructor page: sidebar and main area */
    .constructor-layout {
      display: grid;
      grid-template-columns: 0.4fr 1.6fr;
      gap: 16px;
    }
    @media (max-width: 900px) {
      .constructor-layout {
        grid-template-columns: 1fr;
      }
    }
    .section-nav {
      max-height: 80vh;
      overflow-y: auto;
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      /* –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –ø—Ä–µ–≤—Ä–∞—â–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –≤ –≤—Å–ø–ª—ã–≤–∞—é—â—É—é –ø–∞–Ω–µ–ª—å */
    }
    .section-nav .nav-item {
      cursor: pointer;
      padding: 6px 8px;
      border-radius: 8px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      font-size: 13px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .section-nav .nav-item:hover {
      background: #e0e7ff;
    }
    .section-nav .nav-item.active {
      background: #dbeafe;
      border-color: #2563eb;
    }
    .section-nav .nav-item .error-count {
      font-size: 11px;
      color: #b91c1c;
      margin-left: 6px;
    }

    /* –°–∫—Ä—ã—Ç–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
    .section-nav.hidden {
      display: none;
    }

    /* –ú–æ–±–∏–ª—å–Ω—ã–π —Ä–µ–∂–∏–º: –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å –∑–∞–Ω–∏–º–∞–µ—Ç –≤–µ—Å—å —ç–∫—Ä–∞–Ω –ø–æ–≤–µ—Ä—Ö –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
    @media (max-width: 900px) {
      .section-nav {
        position: fixed;
        top: 60px; /* —Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å –ø–æ–¥ —à–∞–ø–∫–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 999;
        background: rgba(255, 255, 255, 0.97);
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        border-top: 1px solid #e5e7eb;
        border-bottom: 1px solid #e5e7eb;
        padding: 12px;
        overflow-y: auto;
      }
    }

    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º */
    .nav-header .nav-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 2px;
    }
    .nav-header .note {
      /* —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —à—Ä–∏—Ñ—Ç —Ç–µ–∫—Å—Ç–∞ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 6px;
    }

    /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –∏ –Ω–∞–ª–∏—á–∏—è –æ—à–∏–±–æ–∫ –≤ –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–µ */
    .section-nav .nav-item.current {
      background: #e0e7ff;
      border-color: #2563eb;
    }
    .section-nav .nav-item.has-errors {
      border-color: #fca5a5;
    }

    /* Lint list */
    .lint-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 13px;
    }
    .lint-item {
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #e5e7eb;
      background: #fef2f2;
      color: #b91c1c;
      cursor: pointer;
    }
    .lint-item:hover {
      background: #fbd5d5;
    }

    /* Highlight for field when navigating from lint */
    .field-block.highlight {
      border-color: #d97706;
      background: #fef3c7;
      transition: background 0.3s, border-color 0.3s;
    }

    /* Highlight for section when navigating from sidebar */
    .section-block.highlight {
      border-color: #2563eb;
      background: #eff6ff;
      transition: background 0.3s, border-color 0.3s;
    }

  /* Schema preview styles */
  .schema-section {
    border: 1px dashed #e5e7eb;
    border-radius: 10px;
    padding: 8px 10px;
    margin-bottom: 8px;
    background: #f9fafb;
  }
  .schema-section h4 {
    margin: 0 0 4px;
    font-size: 13px;
    font-weight: 600;
  }
  .schema-row {
    font-size: 11px;
    margin: 2px 0;
    padding-left: 4px;
  }

  /* Highlight required fields in builder */
  .field-block.field-required {
    border-width: 2px;
    border-color: #2563eb;
    position: relative;
  }
  .field-block.field-required::before {
    content: '*';
    position: absolute;
    top: 6px;
    left: 6px;
    color: #2563eb;
    font-size: 14px;
    font-weight: 600;
  }
    #jsonOutput {
      width: 100%;
      height: 260px;
      margin-top: 8px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      white-space: pre;
    }

    /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø–æ–ª–µ–π */
    .field-block.field-error {
      border-color: #fca5a5;
      background: #fff8f8;
    }
    .error-msg {
      color: #b91c1c;
      /* —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —à—Ä–∏—Ñ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–µ */
      font-size: 12px;
      margin-top: 4px;
    }

    /* Advanced settings container: hidden by default, shown when open */
    .advanced-settings {
      margin-top: 6px;
      display: none;
    }
    .advanced-settings.open {
      display: block;
      background: #f9fafe;
      padding: 8px;
      border-radius: 8px;
      border: 1px dashed #e5e7eb;
    }

    /* –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –∏ –≤—ã—Å–æ—Ç—ã */
    label {
      min-height: 22px;
      display: flex;
      align-items: center;
    }
    input[type="text"], input[type="number"], select, textarea {
      /* –ø–æ–≤—ã—à–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É –ø–æ–ª–µ–π –¥–ª—è –ª—É—á—à–µ–≥–æ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è */
      min-height: 36px;
    }
    .btn.small {
      /* —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –∫–Ω–æ–ø–æ–∫ */
      padding: 6px 12px;
    }

    /* –†–µ–∂–∏–º –∫–æ–º–ø–∞–∫—Ç–Ω–æ–π —Å—Ö–µ–º—ã –¥–ª—è –ø–æ–ª–µ–π */
    .field-block.schema-mode {
      padding: 6px 8px;
      background: #f9fafb;
      border-style: dashed;
    cursor: pointer;
  }

  /* –°—Ç—Ä–æ–∫–∞ –≤ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ (schema) */
  .field-schema-line {
    font-size: 12px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    }

    /* –ó–Ω–∞—á–æ–∫ –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Ä—è–¥–æ–º —Å label */
    .info-icon {
      font-size: 12px;
      color: #6b7280;
      margin-left: 4px;
      cursor: help;
    }

    /* –ö–Ω–æ–ø–∫–∏ –æ–±–≤–æ–¥–∫–∏ (outline) */
    .btn.outline {
      background: #ffffff;
      border-color: #d1d5db;
      color: #2563eb;
    }
    .btn.outline:hover {
      background: #f3f4f6;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π –ø–æ–ª–µ–π –≤ –ø—Ä–µ–≤—å—é */
    #previewForm fieldset {
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 12px 14px 14px;
      margin-bottom: 12px;
      background: #f9fafb;
    }
    #previewForm legend {
      font-size: 14px;
      font-weight: 600;
    }
    .preview-field:not(:first-child) {
      border-top: 1px solid #e5e7eb;
      padding-top: 8px;
      margin-top: 6px;
    }
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ */
    .builder-controls,
    .preview-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 10px;
    }
    .builder-controls label,
    .preview-controls label {
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    #answersOutput {
      width: 100%;
      height: 160px;
      margin-top: 8px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      white-space: pre;
    }

    /* App header styles */
    .app-header {
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      backdrop-filter: blur(10px);
      background: rgba(255,255,255,0.8);
      border-bottom: 1px solid #e5e7eb;
    }
    .app-header-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .app-header-left h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
    }
    .app-header-left .note {
      font-size: 12px;
      color: #6b7280;
    }
    .app-header-center .tabs {
      display: flex;
      gap: 8px;
    }
    .app-header-center .tab {
      border: none;
      border-radius: 999px;
      background: #f3f4f6;
      padding: 6px 14px;
      cursor: pointer;
      font-size: 13px;
    }
    .app-header-center .tab.active {
      background: #2563eb;
      color: #ffffff;
    }
    .app-header-center .tab.has-errors {
      color: #b91c1c;
    }
    .app-header-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* –î–µ–π—Å—Ç–≤–∏—è –≤ —Ç—É–ª–±–∞—Ä–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ */
    .toolbar-actions {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    .save-status {
      font-size: 11px;
      color: #16a34a;
      opacity: 0.8;
    }
    .save-status.unsaved {
      color: #b45309;
    }

    /* Builder controls rows */
    .builder-controls {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .builder-controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
      align-items: center;
    }
    .builder-controls-row-secondary {
      border-top: 1px dashed #e5e7eb;
      padding-top: 6px;
    }

    /* JSON panel styles */
    .json-panel {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      margin-top: 10px;
    }
    .json-panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 8px;
      cursor: pointer;
      background: #f3f4f6;
      border-bottom: 1px solid #e5e7eb;
      font-size: 14px;
      font-weight: 600;
    }
    .json-panel.collapsed .json-panel-body {
      display: none;
    }
    .json-panel-body {
      padding: 10px;
    }

    /* Navigation improvements */
    .section-nav .nav-item-title {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .section-nav .error-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #b91c1c;
    }

    /* –£–±–∏—Ä–∞–µ–º —Ñ–æ–Ω –∏ —Ä–∞–º–∫—É —É —Ç–∞–±–æ–≤ –≤ —à–∞–ø–∫–µ */
    .app-header .tabs {
      border: none;
      background: transparent;
      padding-left: 0;
    }

  </style>
</head>
<body>
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ –∏ –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ -->
  <header class="app-header">
    <div class="app-header-left">
      <h1>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä–∞ –Ω–æ—É—Ç–±—É–∫–æ–≤</h1>
      <div class="note">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ñ–æ—Ä–º—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ JSON.</div>
    </div>
    <div class="app-header-center">
      <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∫–ª–∞–¥–æ–∫ —Å —Ä–æ–ª—å—é tablist –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ -->
      <div class="tabs" role="tablist">
        <button id="tab-constructor" class="tab active" data-tab="constructor" role="tab" aria-controls="constructorPage" aria-selected="true">‚öôÔ∏è¬†–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</button>
        <button id="tab-lint" class="tab" data-tab="lint" role="tab" aria-controls="lintPage" aria-selected="false">‚úÖ¬†–ü—Ä–æ–≤–µ—Ä–∫–∞</button>
        <button id="tab-preview" class="tab" data-tab="preview" role="tab" aria-controls="previewPage" aria-selected="false">üëÅ¬†–ü—Ä–µ–≤—å—é/–≠–∫—Å–ø–æ—Ä—Ç</button>
      </div>
    </div>
    <div class="app-header-right">
      <button type="button" id="loadTemplateBtnHeader" class="btn small outline" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–º–µ—Ä —Ñ–æ—Ä–º—ã –Ω–æ—É—Ç–±—É–∫–∞">üß©¬†–¢–∏–ø–æ–≤–æ–π –Ω–æ—É—Ç–±—É–∫</button>
      <button type="button" id="resetConfigBtnHeader" class="btn small danger" title="–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã –∏ –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é">üßπ¬†–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
      <span id="saveStatus" class="save-status">–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ</span>
      <!-- –ö–Ω–æ–ø–∫–∞ —è–≤–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage -->
      <button type="button" id="saveProjectBtn" class="btn small outline" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ">üíæ¬†–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <!-- –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ —Ñ–∞–π–ª JSON -->
      <button type="button" id="exportProjectBtn" class="btn small" title="–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ JSON">‚¨á¬†–≠–∫—Å–ø–æ—Ä—Ç</button>
    </div>
  </header>
  <!-- Constructor page -->
  <div id="constructorPage" class="tab-content active" role="tabpanel" aria-labelledby="tab-constructor">
    <div class="page constructor-layout">
      <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º -->
      <div id="sectionNav" class="section-nav card"></div>
      <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä -->
      <div class="card">
        <!-- –í–µ—Ä—Ö–Ω–∏–π —Ç—É–ª–±–∞—Ä –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è –∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π -->
        <div class="toolbar">
          <div>
            <h1>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Ñ–æ—Ä–º—ã</h1>
            <div class="note">
              –®–∞–≥¬†1: —Å–ª–µ–≤–∞¬†‚Äî –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª—ã –∏ –≤–æ–ø—Ä–æ—Å—ã (–Ω–∞–∑–≤–∞–Ω–∏—è, —Ç–∏–ø—ã –ø–æ–ª–µ–π, key).<br>
              –®–∞–≥¬†2: –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É ¬´–ü—Ä–æ–≤–µ—Ä–∫–∞¬ª, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –¥—É–±–ª–∏–∫–∞—Ç—ã.<br>
              –®–∞–≥¬†3: –≤–æ –≤–∫–ª–∞–¥–∫–µ ¬´–ü—Ä–µ–≤—å—é/–≠–∫—Å–ø–æ—Ä—Ç¬ª –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º—É –∏ —Å–∫–∞—á–∞–π—Ç–µ JSON.
            </div>
          </div>
          <!-- –ì—Ä—É–ø–ø–∞ –¥–µ–π—Å—Ç–≤–∏–π: –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª –∏ –æ—Ç–∫—Ä—ã—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é -->
          <div class="toolbar-actions">
            <button type="button" class="btn primary" id="addSectionBtn">+¬†–†–∞–∑–¥–µ–ª</button>
            <button type="button" class="btn small outline" id="toggleNavBtn" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é">üìÇ –ù–∞–≤–∏–≥–∞—Ü–∏—è</button>
          </div>
        </div>

        <!-- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ -->
        <div class="builder-controls">
          <div class="builder-controls-row">
            <label title="–°–∫—Ä—ã–≤–∞–µ—Ç —Ä–∞–∑–¥–µ–ª—ã, –≥–¥–µ –Ω–µ—Ç –æ—à–∏–±–æ–∫"><input type="checkbox" id="showErrorsCheckbox"> –¢–æ–ª—å–∫–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –ø–æ–ª—è</label>
            <label title="–ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –º–µ–∂–¥—É –¥–µ—Ç–∞–ª—å–Ω—ã–º –∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º –≤–∏–¥–æ–º">–í–∏–¥ –ø–æ–ª–µ–π:
              <select id="viewModeSelect">
                <option value="full">–î–µ—Ç–∞–ª—å–Ω—ã–π</option>
                <option value="schema">–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π</option>
              </select>
            </label>
            <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫ –ø—Ä–µ–≤—å—é, –∏–∑–º–µ–Ω–∏—Ç—å –µ–≥–æ –º–æ–∂–Ω–æ –≤–æ –≤–∫–ª–∞–¥–∫–µ "–ü—Ä–µ–≤—å—é" -->
            <label title="–í—ã–±—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫ –ø—Ä–µ–≤—å—é –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∑–¥–µ—Å—å, –∏–∑–º–µ–Ω–∏—Ç—å –µ–≥–æ –º–æ–∂–Ω–æ –≤–æ –≤–∫–ª–∞–¥–∫–µ ‚Äò–ü—Ä–µ–≤—å—é‚Äô">
              –Ø–∑—ã–∫ –ø—Ä–µ–≤—å—é: <span id="currentPreviewLang">RU</span>
            </label>
            <label title="–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–ª–∏ —Å–∫—Ä—ã–≤–∞—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –ø–æ–¥–ø–∏—Å–∏ (EN) –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ"><input type="checkbox" id="toggleEnglishLabels"> –ü–æ–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ (EN)</label>
            <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —É—Ä–æ–≤–Ω—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞: –ø—Ä–æ—Å—Ç–æ–π –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π -->
            <label title="–í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞">–†–µ–∂–∏–º:
              <select id="builderModeSelect">
                <option value="simple">–ü—Ä–æ—Å—Ç–æ–π</option>
                <option value="advanced">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π</option>
              </select>
            </label>
          </div>
          <div class="builder-controls-row builder-controls-row-secondary">
            <!-- –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–∞ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞, –æ—Å—Ç–∞–≤–ª—è—è –µ—ë –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ —à–∞–ø–∫–∏ -->
            <button type="button" id="loadTemplateBtn" class="btn small outline" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–º–µ—Ä —Ñ–æ—Ä–º—ã –Ω–æ—É—Ç–±—É–∫–∞" style="display:none">üß©¬†–¢–∏–ø–æ–≤–æ–π –Ω–æ—É—Ç–±—É–∫</button>
            <span class="note">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–º–µ—Ä —Ñ–æ—Ä–º—ã —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏ –Ω–æ—É—Ç–±—É–∫–∞ (—ç–∫—Ä–∞–Ω, –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä, –ø–∞–º—è—Ç—å, –Ω–∞–∫–æ–ø–∏—Ç–µ–ª–∏).</span>
            <!-- –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–±—Ä–æ—Å–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞, –æ—Å—Ç–∞–≤–ª—è—è –µ—ë –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ —à–∞–ø–∫–∏ -->
            <button type="button" class="btn small danger" id="resetConfigBtn" title="–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã –∏ –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é" style="display:none">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
          </div>
          <div class="note">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–∏–¥ –ø–æ–ª–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä—ã, –∑–∞—Ç–µ–º –¥–æ–±–∞–≤–ª—è–π—Ç–µ —Ä–∞–∑–¥–µ–ª—ã –∏ –≤–æ–ø—Ä–æ—Å—ã.</div>
        </div>
        <div id="sectionsContainer"></div>
      </div>
    </div>
  </div>
  <!-- Lint page -->
  <!-- Lint page -->
  <div id="lintPage" class="tab-content" role="tabpanel" aria-labelledby="tab-lint">
    <div class="page">
      <div class="card">
        <h2>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</h2>
        <div class="note">–ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ö–ª–∏–∫ –ø–æ –æ—à–∏–±–∫–µ ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ –Ω—É–∂–Ω–æ–º—É –ø–æ–ª—é –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ.</div>
        <div id="lintList" class="lint-list"></div>
      </div>
    </div>
  </div>
  <!-- Preview page -->
  <!-- Preview page -->
  <div id="previewPage" class="tab-content" role="tabpanel" aria-labelledby="tab-preview">
    <div class="page">
      <div class="card">
        <h2>–ü—Ä–µ–≤—å—é –∏ —ç–∫—Å–ø–æ—Ä—Ç</h2>
        <div class="note">–ó–¥–µ—Å—å –≤—ã –≤–∏–¥–∏—Ç–µ —Ñ–æ—Ä–º—É –∫–∞–∫ –µ—ë —É–≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ JSON-–æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.</div>
        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é –∏ JSON -->
        <div class="preview-controls">
          <button type="button" class="btn small" id="clearPreviewBtn" title="–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–µ">–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button>
          <button type="button" class="btn small primary" id="buildAnswersBtn" title="–°–æ–±—Ä–∞—Ç—å –≤–≤–µ–¥—ë–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –æ–±—ä–µ–∫—Ç –æ—Ç–≤–µ—Ç–æ–≤">–°–æ–±—Ä–∞—Ç—å –æ—Ç–≤–µ—Ç—ã</button>
          <button type="button" class="btn small primary" id="downloadJsonBtn" title="–°–∫–∞—á–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–æ—Ä–º—ã –≤ JSON">–°–∫–∞—á–∞—Ç—å JSON</button>
          <button type="button" class="btn small outline" id="uploadJsonBtn" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–æ—Ä–º—ã –∏–∑ JSON">–ó–∞–≥—Ä—É–∑–∏—Ç—å JSON</button>
          <input type="file" id="uploadJsonFile" accept="application/json" style="display:none">
          <label title="–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞: —Ñ–æ—Ä–º–∞ –∏–ª–∏ —Å—Ö–µ–º–∞">–†–µ–∂–∏–º –ø—Ä–µ–≤—å—é:
            <select id="previewModeSelect">
              <option value="form">–§–æ—Ä–º–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>
              <option value="schema">–¢–µ–∫—Å—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –ø–æ–ª–µ–π</option>
            </select>
          </label>
          <label title="–Ø–∑—ã–∫ —Ç–µ–∫—Å—Ç–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ —Ñ–æ—Ä–º–µ">–Ø–∑—ã–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ —Ñ–æ—Ä–º–µ:
            <select id="previewLangSelectPreview">
              <option value="ru">RU</option>
              <option value="en">EN</option>
            </select>
          </label>
        </div>
        <div class="note">
          ‚Äú–°–æ–±—Ä–∞—Ç—å –æ—Ç–≤–µ—Ç—ã‚Äù ‚Äî –≤–∑—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ñ–æ—Ä–º—ã –≤—ã—à–µ –∏ –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä –æ–±—ä–µ–∫—Ç–∞ —Å –æ—Ç–≤–µ—Ç–∞–º–∏.<br>
          ‚Äú–°–∫–∞—á–∞—Ç—å JSON‚Äù ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–æ—Ä–º—ã (—Ä–∞–∑–¥–µ–ª—ã, –ø–æ–ª—è, —Ç–∏–ø—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é) –≤ —Ñ–∞–π–ª.<br>
          ‚Äú–ó–∞–≥—Ä—É–∑–∏—Ç—å JSON‚Äù ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∏–∑ —Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.<br>
          ‚Äú–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç‚Äù ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ –±—Ä–∞—É–∑–µ—Ä–µ (localStorage), —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–∞–±–æ—Ç–µ –ø–æ–∑–∂–µ.<br>
          ‚Äú–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç‚Äù ‚Äî —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª JSON, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –Ω–∞ –¥—Ä—É–≥–æ–π –∫–æ–º–ø—å—é—Ç–µ—Ä –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–ª–ª–µ–≥–∞–º.
        </div>
        <form id="previewForm"></form>
        <!-- –ò—Ç–æ–≥–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Ñ–æ—Ä–º—É -->
        <div id="answersArea">
          <h3>–ü—Ä–∏–º–µ—Ä –æ–±—ä–µ–∫—Ç–∞ –æ—Ç–≤–µ—Ç–æ–≤</h3>
          <div id="answersPlaceholder" class="note">–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –ø—Ä–∏–º–µ—Ä –æ–±—ä–µ–∫—Ç–∞ –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è ‚Äú–°–æ–±—Ä–∞—Ç—å –æ—Ç–≤–µ—Ç—ã‚Äù.</div>
          <textarea id="answersOutput" readonly style="display:none"></textarea>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å JSON-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ -->
        <div class="json-panel collapsed" id="jsonPanel">
          <div class="json-panel-header" id="toggleJsonPanelBtn">JSON‚Äë–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</div>
          <div class="json-panel-body">
            <div class="note">
              –ó–¥–µ—Å—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–æ—Ä–º—ã: —Ä–∞–∑–¥–µ–ª—ã, –ø–æ–ª—è, —Ç–∏–ø—ã, –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏. –ü—Ä–æ–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ. –î–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç –∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏–π –∏–º–ø–æ—Ä—Ç JSON.<br>
              –≠—Ç–æ—Ç JSON –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å—Ç–∞–≤—â–∏–∫—É –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.
            </div>
            <textarea id="jsonOutput" readonly></textarea>
            <div class="note">
              <label><input type="checkbox" id="enableJsonEdit"> –†–∞–∑—Ä–µ—à–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ JSON –≤—Ä—É—á–Ω—É—é (–æ–ø–∞—Å–Ω–æ)</label>
            </div>
            <!-- –ö–Ω–æ–ø–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—Ä—É—á–Ω—É—é –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ JSON. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ —Ç–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
                 –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å–æ–¥–µ—Ä–∂–∏–º—ã–º —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —É–±–µ–¥–∏—Ç—å—Å—è,
                 —á—Ç–æ —Ñ–æ—Ä–º–∞—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π. -->
            <div class="note">
              <button type="button" id="applyJsonBtn" class="btn small primary" title="–ü—Ä–∏–º–µ–Ω–∏—Ç—å JSON –ø–æ—Å–ª–µ —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è">–ü—Ä–∏–º–µ–Ω–∏—Ç—å JSON</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- –£–°–¢–ê–†–ï–í–®–ò–ô –ö–û–î —É–¥–∞–ª—ë–Ω -->

  <!-- –ù–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ —Ñ–æ—Ä–º—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ -->
  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Ñ–æ—Ä–º—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏
    (() => {
      // –°—á—ë—Ç—á–∏–∫–∏ –¥–ª—è id
      let sectionCounter = 1;
      let fieldCounter = 1;
      // –ò–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ (–¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)
      let currentSectionIndex = null;
      // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏ –ø–æ–ª—è EN-–ø–µ—Ä–µ–≤–æ–¥–∞ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
      let showEnglishLabels = false;
      // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
      let config = [];
      // –§–ª–∞–≥–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
      let showOnlyErrors = false;
      let viewMode = 'full'; // 'full' –∏–ª–∏ 'schema'
      let previewLang = 'ru';
      // –†–µ–∂–∏–º –ø—Ä–µ–≤—å—é: 'form' (—Ñ–æ—Ä–º–∞) –∏–ª–∏ 'schema' (–æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ö–µ–º—ã)
      let previewMode = 'form';

      // –†–µ–∂–∏–º –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞: 'simple' ‚Äî —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ –ø–æ–ª—è, 'advanced' ‚Äî –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
      let builderMode = 'simple';

      // –¢–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–± ('constructor', 'lint', 'preview')
      let currentTab = 'constructor';

      // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
      const FIELD_TYPES = ['text','number','select','checkbox','textarea','radio','multiselect'];
      const OPTIONS_TYPES = ['select','radio','multiselect'];

      // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
      /**
       * –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥–ø–∏—Å—å –ø–æ–ª—è —Å —É—á—ë—Ç–æ–º —è–∑—ã–∫–∞ –∏ fallback.
       * @param {Object} field
       * @param {string} lang - 'ru' –∏–ª–∏ 'en'
       * @returns {string} –ø–æ–¥–ø–∏—Å—å –∏–ª–∏ fallback
       */
      function getFieldLabel(field, lang = 'ru') {
        if (!field || !field.labels) return field && field.name ? field.name : '';
        const txt = field.labels[lang];
        if (txt && txt.trim() !== '') return txt;
        // fallback –Ω–∞ —Ä—É—Å—Å–∫–∏–π
        const ru = field.labels.ru;
        if (ru && ru.trim() !== '') return ru;
        // fallback –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è
        return field.name || '';
      }

      /**
       * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ key —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –ª–∞—Ç–∏–Ω–∏—Ü—ã, —Ü–∏—Ñ—Ä –∏ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–π –∏ –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —Ü–∏—Ñ—Ä—ã.
       * @param {string} str
       * @returns {boolean}
       */
      function isValidKey(str) {
        return /^[a-zA-Z_][a-zA-Z0-9_]*$/.test(str);
      }

      /**
       * –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ key —É–Ω–∏–∫–∞–ª–µ–Ω –≤ —Ç–µ–∫—É—â–µ–º config. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Å—É—Ñ—Ñ–∏–∫—Å.
       * @param {string} key
       * @returns {string} —É–Ω–∏–∫–∞–ª—å–Ω—ã–π key
       */
      function ensureUniqueKey(key) {
        let base = key;
        let idx = 1;
        let candidate = key;
        while (config && config.some(sec => sec.fields.some(f => f.name === candidate))) {
          candidate = base + '_' + idx++;
        }
        return candidate;
      }

      /**
       * –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥–ø–∏—Å—å –¥–ª—è –ø—Ä–µ–≤—å—é —Å fallback: —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫, –ø–æ—Ç–æ–º —Ä—É—Å—Å–∫–∏–π, –ø–æ—Ç–æ–º name
       * @param {Object} field
       * @param {string} previewLang
       * @returns {string}
       */
      function getLabelFallback(field, previewLang) {
        return getFieldLabel(field, previewLang);
      }

      /**
       * –°—Ç–∞—Ç—É—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
       *
       * markUnsaved() —Å–ª–µ–¥—É–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–∏ –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, —á—Ç–æ–±—ã
       * –ø–æ–º–µ—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π. –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —Ç–æ–ª—å–∫–æ –º–µ–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç –∏ –∫–ª–∞—Å—Å
       * –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ #saveStatus –∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–µ–Ω–¥–µ—Ä –∏–ª–∏ –∑–∞–ø–∏—Å—å –≤ localStorage.
       *
       * markSaved() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —è–≤–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/—ç–∫—Å–ø–æ—Ä—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞
       * (–∫–Ω–æ–ø–∫–∞ ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å¬ª/¬´–≠–∫—Å–ø–æ—Ä—Ç¬ª –∏–ª–∏ –≥–æ—Ä—è—á–∞—è –∫–ª–∞–≤–∏—à–∞ Ctrl+S). –≠—Ç–æ—Ç –º–µ—Ç–æ–¥
       * –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Ç–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ localStorage –∏
       * —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–º —Ñ–∞–π–ª–æ–º.
       */
      function markUnsaved() {
        const el = document.getElementById('saveStatus');
        if (el) {
          el.classList.add('unsaved');
          el.textContent = '–ù–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ';
        }
      }
      function markSaved() {
        const el = document.getElementById('saveStatus');
        if (el) {
          el.classList.remove('unsaved');
          el.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ';
        }
      }
      /**
       * –†–∞–∑–±–∏—Ç—å —Å—Ç—Ä–æ–∫—É –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–∞ –º–∞—Å—Å–∏–≤
       * @param {string} str
       * @returns {string[]}
       */
      function parseOptions(str) {
        return (str || '').split(',').map(v => v.trim()).filter(Boolean);
      }
      /**
       * –ò–∑–≤–ª–µ—á—å —á–∏—Å–ª–æ–≤—É—é —á–∞—Å—Ç—å id (–Ω–∞–ø—Ä–∏–º–µ—Ä, s_3 ‚Üí 3)
       * @param {string} id
       * @returns {number}
       */
      function getNumericId(id) {
        const parts = (id || '').toString().split('_');
        const num = parseInt(parts[1], 10);
        return isNaN(num) ? 0 : num;
      }
      /**
       * –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: –ø—Ä–∏–≤–µ—Å—Ç–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–æ–ª—è –∫ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ,
       * –∑–∞–ø–æ–ª–Ω–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å—á—ë—Ç—á–∏–∫–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤.
       *
       * –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ localStorage, –∏–º–ø–æ—Ä—Ç–∞ JSON
       * –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞. –û–Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–∞–∂–¥–æ–µ –ø–æ–ª–µ –∏–º–µ–µ—Ç –æ–±—ä–µ–∫—Ç labels,
       * –æ–±—ä–µ–∫—Ç validation –∏ —Ñ–ª–∞–≥ showAdvanced. –¢–∞–∫–∂–µ –æ–Ω–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç sectionCounter –∏
       * fieldCounter, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö —á–∏—Å–ª–æ–≤—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞—Ö –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
       *
       * @param {Array} cfg - –ú–∞—Å—Å–∏–≤ —Ä–∞–∑–¥–µ–ª–æ–≤ —Ñ–æ—Ä–º—ã
       */
      function normalizeConfig(cfg) {
        // –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
        if (!Array.isArray(cfg)) return;
        let maxS = 0;
        let maxF = 0;
        cfg.forEach((section) => {
          // –û–±–Ω–æ–≤–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä —Ä–∞–∑–¥–µ–ª–∞
          const sid = getNumericId(section.id);
          if (sid > maxS) maxS = sid;
          // –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —É —Ä–∞–∑–¥–µ–ª–∞ –µ—Å—Ç—å –º–∞—Å—Å–∏–≤ –ø–æ–ª–µ–π
          if (!Array.isArray(section.fields)) {
            section.fields = [];
          }
          section.fields.forEach((field) => {
            // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–µ–µ –ø–æ–ª–µ label –≤ –æ–±—ä–µ–∫—Ç labels
            if (!field.labels) {
              field.labels = { ru: field.label || '', en: '' };
            }
            // –£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–µ–µ —Å–≤–æ–π—Å—Ç–≤–æ label, –µ—Å–ª–∏ –æ–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if (typeof field.label !== 'undefined') {
              delete field.label;
            }
            // –°–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç validation, –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
            if (!field.validation) {
              field.validation = { min:'', max:'', step:'', pattern:'', format:'' };
            }
            // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–ª–∞–≥ showAdvanced, –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
            if (typeof field.showAdvanced === 'undefined') {
              field.showAdvanced = false;
            }
            // –û–±–Ω–æ–≤–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –ø–æ–ª—è
            const fid = getNumericId(field.id);
            if (fid > maxF) maxF = fid;
          });
        });
        // –û–±–Ω–æ–≤–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏ –¥–ª—è –±—É–¥—É—â–∏—Ö id
        sectionCounter = maxS + 1;
        fieldCounter = maxF + 1;
      }
      /**
       * –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –ø—Ä–µ–≤—å—é –∏ –æ–±–Ω–æ–≤–∏—Ç—å JSON
       */
      function rerenderAll() {
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, JSON –∏ –ø–∞–Ω–µ–ª–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏/–ø—Ä–æ–≤–µ—Ä–∫–∏. –°—Ç–∞—Ç—É—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ updateJson().
        renderBuilder();
        renderPreview();
        updateJson();
        // —Ç–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –∏ –ø–∞–Ω–µ–ª—å –ø—Ä–æ–≤–µ—Ä–∫–∏
        renderSectionNav();
        renderLintPanel();
      }

      /**
       * –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—à–∏–±–æ–∫ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.
       * –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º (!), –∏–Ω–∞—á–µ —É–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä.
       */
      function updateLintTabIndicator() {
        const lintTab = document.querySelector('.tab[data-tab="lint"]');
        if (!lintTab) return;
        const problemsCount = validateConfig().problems.length;
        if (problemsCount > 0) {
          lintTab.innerHTML = '‚úÖ¬†–ü—Ä–æ–≤–µ—Ä–∫–∞ <span style="color:#b91c1c">(!)</span>';
          lintTab.classList.add('has-errors');
        } else {
          lintTab.innerHTML = '‚úÖ¬†–ü—Ä–æ–≤–µ—Ä–∫–∞';
          lintTab.classList.remove('has-errors');
        }
      }

      // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
      function createSection() {
        return {
          id: 's_' + (sectionCounter++),
          title: '–ù–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª',
          fields: []
        };
      }
      // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è
      function createField() {
        return {
          id: 'f_' + (fieldCounter++),
          name: '',
          labels: { ru: '–ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å', en: '' },
          type: 'text',
          options: '',
          required: false,
          hint: '',
          validation: {
            min: '',
            max: '',
            step: '',
            pattern: '',
            format: ''
          },
          // —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
          showAdvanced: false
        };
      }

      // –¢—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏—è –∫–∏—Ä–∏–ª–ª–∏—Ü—ã –≤ –ª–∞—Ç–∏–Ω–∏—Ü—É –¥–ª—è slug
      function generateKeyFromLabel(label) {
        const map = {
          '–∞':'a','–±':'b','–≤':'v','–≥':'g','–¥':'d','–µ':'e','—ë':'e','–∂':'zh','–∑':'z','–∏':'i','–π':'y','–∫':'k','–ª':'l','–º':'m',
          '–Ω':'n','–æ':'o','–ø':'p','—Ä':'r','—Å':'s','—Ç':'t','—É':'u','—Ñ':'f','—Ö':'h','—Ü':'ts','—á':'ch','—à':'sh','—â':'shch',
          '—ã':'y','—ç':'e','—é':'yu','—è':'ya','—å':'','—ä':'','—ó':'i','—ñ':'i','“ë':'g','—î':'e'
        };
        let slug = '';
        label = (label || '').toString().toLowerCase();
        for (let ch of label) {
          if (map[ch]) {
            slug += map[ch];
          } else if (/[a-z0-9]/.test(ch)) {
            slug += ch;
          } else if (/[\s\-]/.test(ch) || ch === '_') {
            slug += '_';
          }
        }
        slug = slug.replace(/_+/g, '_').replace(/^_+|_+$/g, '');
        // –£–Ω–∏–∫–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–ª—é—á —á–µ—Ä–µ–∑ —Ö–µ–ª–ø–µ—Ä ensureUniqueKey
        return ensureUniqueKey(slug);
      }

      // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: –ø–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∫–ª—é—á–µ–π
      function validateConfig() {
        const problems = [];
        const nameCounts = {};
        config.forEach((section, sIdx) => {
          section.fields.forEach((field, fIdx) => {
            const errs = [];
            const name = field.name || '';
            if (!name) {
              errs.push('noName');
            } else {
              // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ key
              if (!isValidKey(name)) {
                errs.push('badKeyFormat');
              }
            }
            const labelRu = field.labels && field.labels.ru ? field.labels.ru : '';
            if (!labelRu || labelRu.trim() === '') errs.push('noLabel');
            if (OPTIONS_TYPES.includes(field.type)) {
              const opts = parseOptions(field.options);
              if (opts.length === 0) errs.push('noOptions');
            }
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π
        if (field.type === 'text' && field.validation && field.validation.pattern) {
          try {
            // –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
            new RegExp(field.validation.pattern);
          } catch (err) {
            errs.push('badPattern');
          }
        }
            nameCounts[name] = (nameCounts[name] || 0) + 1;
            if (errs.length > 0) {
              problems.push({sIdx, fIdx, errors: errs});
            }
          });
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Å—Ç–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞
        if (!section.title || !section.title.trim()) {
          problems.push({sIdx, fIdx: null, errors: ['emptySectionTitle']});
        }
        });
        const duplicates = {};
        Object.keys(nameCounts).forEach((key) => {
          if (key && nameCounts[key] > 1) {
            duplicates[key] = nameCounts[key];
          }
        });
        Object.keys(duplicates).forEach((dupName) => {
          config.forEach((section, sIdx) => {
            section.fields.forEach((field, fIdx) => {
              if (field.name === dupName) {
                const existing = problems.find(p => p.sIdx === sIdx && p.fIdx === fIdx);
                if (existing) {
                  existing.errors.push('duplicate');
                } else {
                  problems.push({sIdx, fIdx, errors: ['duplicate']});
                }
              }
            });
          });
        });
        return {problems, duplicates};
      }

      // –®–∞–±–ª–æ–Ω –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–æ—É—Ç–±—É–∫–∞
      function loadLaptopTemplate() {
        const sections = [];
        let localSectionCounter = sectionCounter;
        let localFieldCounter = fieldCounter;
        // –≠–∫—Ä–∞–Ω
        const screen = {
          id: 's_' + (localSectionCounter++),
          title: '–≠–∫—Ä–∞–Ω',
          fields: [
            {
              id: 'f_' + (localFieldCounter++),
              name: 'screen_diagonal',
              labels: {ru:'–î–∏–∞–≥–æ–Ω–∞–ª—å —ç–∫—Ä–∞–Ω–∞', en:'Screen diagonal'},
              type: 'number',
              options: '',
              required: true,
              hint: '',
              validation: {min:'10',max:'20',step:'0.1',pattern:'',format:''},
              showAdvanced: false
            },
            {
              id: 'f_' + (localFieldCounter++),
              name: 'panel_type',
              labels: {ru:'–¢–∏–ø –ø–∞–Ω–µ–ª–∏', en:'Panel type'},
              type: 'select',
              options: 'IPS, TN, VA, OLED',
              required: false,
              hint: '',
              validation: {min:'',max:'',step:'',pattern:'',format:''},
              showAdvanced: false
            },
            {
              id: 'f_' + (localFieldCounter++),
              name: 'refresh_rate',
              labels: {ru:'–ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', en:'Refresh rate'},
              type: 'number',
              options: '',
              required: false,
              hint: '',
              validation: {min:'30',max:'240',step:'1',pattern:'',format:''},
              showAdvanced: false
            }
          ]
        };
        // –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä
        const cpu = {
          id: 's_' + (localSectionCounter++),
          title: '–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä',
          fields: [
            {
              id: 'f_' + (localFieldCounter++),
              name: 'cpu_model',
              labels: {ru:'–ú–æ–¥–µ–ª—å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞', en:'CPU model'},
              type: 'text',
              options: '',
              required: true,
              hint: '',
              validation: {min:'',max:'',step:'',pattern:'',format:''},
              showAdvanced: false
            },
            {
              id: 'f_' + (localFieldCounter++),
              name: 'core_count',
              labels: {ru:'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —è–¥–µ—Ä', en:'Core count'},
              type: 'number',
              options: '',
              required: true,
              hint: '',
              validation: {min:'1',max:'32',step:'1',pattern:'',format:''},
              showAdvanced: false
            }
          ]
        };
        // –ü–∞–º—è—Ç—å
        const mem = {
          id: 's_' + (localSectionCounter++),
          title: '–ü–∞–º—è—Ç—å',
          fields: [
            {
              id: 'f_' + (localFieldCounter++),
              name: 'ram_size',
              labels: {ru:'–û–±—ä—ë–º –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ (–ì–ë)', en:'RAM size'},
              type: 'number',
              options: '',
              required: true,
              hint: '',
              validation: {min:'1',max:'128',step:'1',pattern:'',format:''},
              showAdvanced: false
            }
          ]
        };
        // –ù–∞–∫–æ–ø–∏—Ç–µ–ª–∏
        const storage = {
          id: 's_' + (localSectionCounter++),
          title: '–ù–∞–∫–æ–ø–∏—Ç–µ–ª–∏',
          fields: [
            {
              id: 'f_' + (localFieldCounter++),
              name: 'ssd_capacity',
              labels: {ru:'–Å–º–∫–æ—Å—Ç—å SSD (–ì–ë)', en:'SSD capacity'},
              type: 'number',
              options: '',
              required: true,
              hint: '',
              validation: {min:'128',max:'4000',step:'128',pattern:'',format:''},
              showAdvanced: false
            },
            {
              id: 'f_' + (localFieldCounter++),
              name: 'ssd_interface',
              labels: {ru:'–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å SSD', en:'SSD interface'},
              type: 'select',
              options: 'SATA, NVMe',
              required: false,
              hint: '',
              validation: {min:'',max:'',step:'',pattern:'',format:''},
              showAdvanced: false
            }
          ]
        };
        sections.push(screen, cpu, mem, storage);
        // –ü—Ä–∏–≤–µ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω –∫ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å—á—ë—Ç—á–∏–∫–∏
        normalizeConfig(sections);
        return sections;
      }

      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–π/–ø–æ–ª–µ–π
      function addSection() {
        // –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–µ–∫—Ü–∏–∏ –ø–æ–º–µ—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
        markUnsaved();
        const newSection = createSection();
        config.push(newSection);
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π
        currentSectionIndex = config.length - 1;
        rerenderAll();
        // –ü–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞ —Ñ–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
        setTimeout(() => {
          const inputs = document.querySelectorAll('.section-header input[type="text"]');
          if (inputs.length > 0) {
            const lastInput = inputs[inputs.length - 1];
            lastInput.focus();
          }
        }, 0);
      }
      function removeSection(index) {
        // –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–µ–∫—Ü–∏–∏ –ø–æ–º–µ—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
        markUnsaved();
        config.splice(index, 1);
        rerenderAll();
      }
      function addField(sIdx) {
        // –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—è –ø–æ–º–µ—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
        markUnsaved();
        const newField = createField();
        config[sIdx].fields.push(newField);
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–¥–µ–ª, —á—Ç–æ–±—ã –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ–¥—Å–≤–µ—Ç–∏–ª–∞ –µ–≥–æ
        currentSectionIndex = sIdx;
        rerenderAll();
        // –ü–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–∫—É—Å –Ω–∞ –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è
        setTimeout(() => {
          // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –ø–æ–ª—è –≤ —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –∏ –≤—ã–±–∏—Ä–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ
          const sectionFields = document.querySelectorAll(`.section-block[data-section-index="${sIdx}"] .field-block`);
          if (sectionFields.length > 0) {
            const lastField = sectionFields[sectionFields.length - 1];
            const inputEl = lastField.querySelector('input[type="text"]');
            if (inputEl) inputEl.focus();
          }
        }, 0);
      }
      function removeField(sIdx, fIdx) {
        // –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—è –ø–æ–º–µ—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
        markUnsaved();
        config[sIdx].fields.splice(fIdx, 1);
        rerenderAll();
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
      function renderBuilder() {
        const container = document.getElementById('sectionsContainer');
        container.innerHTML = '';
        const validation = validateConfig();
        const problemMap = {};
        validation.problems.forEach(({sIdx, fIdx, errors}) => {
          if (!problemMap[sIdx]) problemMap[sIdx] = {};
          problemMap[sIdx][fIdx] = errors;
        });
        config.forEach((section, sIdx) => {
          if (showOnlyErrors) {
            const sectionProblems = validation.problems.filter(p => p.sIdx === sIdx);
            if (sectionProblems.length === 0) return;
          }
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'section-block';
            // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω–¥–µ–∫—Å –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            sectionDiv.dataset.sectionIndex = sIdx;
          const header = document.createElement('div');
          header.className = 'section-header';
          const titleInput = document.createElement('input');
          titleInput.type = 'text';
          titleInput.value = section.title;
          titleInput.placeholder = '–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞';
          titleInput.addEventListener('input', (e) => {
            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞ ‚Äî –æ—Ç–º–µ—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
            markUnsaved();
            section.title = e.target.value;
            renderPreview();
            updateJson();
          });
          // Pressing Enter in the section title adds a new question immediately
          titleInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
              e.preventDefault();
              addField(sIdx);
            }
          });
          const btnGroup = document.createElement('div');
          btnGroup.style.display = 'flex';
          btnGroup.style.gap = '4px';
          // Up section
          const upBtn = document.createElement('button');
          upBtn.type = 'button';
          upBtn.className = 'btn small';
          upBtn.textContent = '‚Üë';
          if (sIdx === 0) upBtn.disabled = true;
          upBtn.addEventListener('click', () => {
            if (sIdx > 0) {
              const tmp = config[sIdx];
              config[sIdx] = config[sIdx - 1];
              config[sIdx - 1] = tmp;
              // –ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ–∫—Ü–∏–∏ –∏–∑–º–µ–Ω—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é ‚Äî –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
              markUnsaved();
              rerenderAll();
            }
          });
          btnGroup.appendChild(upBtn);
          // Down section
          const downBtn = document.createElement('button');
          downBtn.type = 'button';
          downBtn.className = 'btn small';
          downBtn.textContent = '‚Üì';
          if (sIdx >= config.length - 1) downBtn.disabled = true;
          downBtn.addEventListener('click', () => {
            if (sIdx < config.length - 1) {
              const tmp = config[sIdx];
              config[sIdx] = config[sIdx + 1];
              config[sIdx + 1] = tmp;
              // –ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ–∫—Ü–∏–∏ –∏–∑–º–µ–Ω—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é ‚Äî –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
              markUnsaved();
              rerenderAll();
            }
          });
          btnGroup.appendChild(downBtn);
          // Duplicate section
          const dupBtn = document.createElement('button');
          dupBtn.type = 'button';
          dupBtn.className = 'btn small';
          dupBtn.textContent = '‚ßâ';
          dupBtn.title = '–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–¥–µ–ª';
          dupBtn.addEventListener('click', () => {
            const copy = JSON.parse(JSON.stringify(section));
            copy.id = 's_' + (sectionCounter++);
            copy.title = section.title + ' (–∫–æ–ø–∏—è)';
            copy.fields.forEach((fld) => {
              fld.id = 'f_' + (fieldCounter++);
              if (fld.name) fld.name = fld.name + '_copy';
            });
            config.splice(sIdx + 1, 0, copy);
            // –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ –∏–∑–º–µ–Ω—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é ‚Äî –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
            markUnsaved();
            rerenderAll();
          });
          btnGroup.appendChild(dupBtn);
          // Add field
          const addF = document.createElement('button');
          addF.type = 'button';
          addF.className = 'btn small';
          addF.textContent = '+ –í–æ–ø—Ä–æ—Å';
          addF.addEventListener('click', () => addField(sIdx));
          btnGroup.appendChild(addF);
          // Remove section
          const remS = document.createElement('button');
          remS.type = 'button';
          remS.className = 'btn small danger';
          remS.textContent = '‚úï';
          remS.title = '–£–¥–∞–ª–∏—Ç—å —Ä–∞–∑–¥–µ–ª';
          remS.addEventListener('click', () => removeSection(sIdx));
          btnGroup.appendChild(remS);
          header.appendChild(titleInput);
          header.appendChild(btnGroup);
          sectionDiv.appendChild(header);
          // –ü–æ–ª—è
          section.fields.forEach((field, fIdx) => {
            if (showOnlyErrors && (!problemMap[sIdx] || !problemMap[sIdx][fIdx])) return;
            // –í –∫–æ–º–ø–∞–∫—Ç–Ω–æ–º (schema) —Ä–µ–∂–∏–º–µ —Ä–µ–Ω–¥–µ—Ä–∏–º —É–ø—Ä–æ—â—ë–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É –∏ –≤—ã—Ö–æ–¥–∏–º
            if (viewMode === 'schema') {
              const schemaDiv = document.createElement('div');
              schemaDiv.className = 'field-block schema-mode';
              schemaDiv.dataset.sectionIndex = sIdx;
              schemaDiv.dataset.fieldIndex = fIdx;
              // –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏–∑ lint –Ω—É–∂–µ–Ω data-field-id
              schemaDiv.dataset.fieldId = field.id;
              const line = document.createElement('div');
              line.className = 'field-schema-line';
              const labelText = getFieldLabel(field, 'ru') || field.name || '';
              const keyText = field.name || '';
              const typeText = field.type;
              const reqText = field.required ? '–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ' : '–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ';
              line.textContent = `${labelText} ‚Üí ${keyText} ¬∑ ${typeText} ¬∑ ${reqText}`;
              schemaDiv.appendChild(line);
              if (problemMap[sIdx] && problemMap[sIdx][fIdx] && problemMap[sIdx][fIdx].length > 0) {
                schemaDiv.classList.add('field-error');
              }
              schemaDiv.addEventListener('click', () => {
                viewMode = 'full';
                const viewSel = document.getElementById('viewModeSelect');
                if (viewSel) viewSel.value = 'full';
                rerenderAll();
                scrollToField(sIdx, fIdx);
              });
              sectionDiv.appendChild(schemaDiv);
              return;
            }
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'field-block';
            fieldDiv.dataset.sectionIndex = sIdx;
            fieldDiv.dataset.fieldIndex = fIdx;
            fieldDiv.dataset.fieldId = field.id;
            if (field.required) fieldDiv.classList.add('field-required');
            if (problemMap[sIdx] && problemMap[sIdx][fIdx]) fieldDiv.classList.add('field-error');
            // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –±–∞–∑–æ–≤—ã—Ö –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
            const basic = document.createElement('div');
            basic.className = 'basic-settings';
            const advanced = document.createElement('div');
            advanced.className = 'advanced-settings';
            // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å advanced, –µ—Å–ª–∏ –ø–æ–ª–µ —Ä–∞—Å–∫—Ä—ã—Ç–æ
            if (field.showAdvanced) {
              advanced.classList.add('open');
            }
            const row = document.createElement('div');
            row.className = 'field-row';
            // Labels RU/EN
            const labelWrapper = document.createElement('div');
            const ruLabel = document.createElement('label');
            ruLabel.textContent = '–¢–µ–∫—Å—Ç (RU)';
            const ruInput = document.createElement('input');
            ruInput.type = 'text';
            ruInput.value = (field.labels && field.labels.ru) || '';
            ruInput.placeholder = '–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–∞—Ç–µ—Ä–∏–∞–ª –∫–æ—Ä–ø—É—Å–∞';
            ruInput.addEventListener('input', (e) => {
              // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤–æ–ø—Ä–æ—Å–∞ (RU) ‚Äî –æ—Ç–º–µ—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
              markUnsaved();
              const val = e.target.value;
              field.labels = field.labels || {ru:'', en:''};
              field.labels.ru = val;
              // Automatically fill key only if empty
              if (!field.name) {
                const slug = generateKeyFromLabel(val);
                field.name = slug;
                // key changed in data ‚Äî update JSON –∏ preview only
                updateJson();
                renderPreview();
              } else {
                // Only update preview and JSON, no full rerender to keep focus
                renderPreview();
                updateJson();
              }
            });
            // On blur, recalc duplicates and fully rerender builder
            ruInput.addEventListener('blur', () => {
              rerenderAll();
            });
            const enLabel = document.createElement('label');
            enLabel.textContent = '–¢–µ–∫—Å—Ç (EN)';
            const enInput = document.createElement('input');
            enInput.type = 'text';
            enInput.value = (field.labels && field.labels.en) || '';
            enInput.placeholder = '–ù–∞–ø—Ä–∏–º–µ—Ä: Case material';
            enInput.addEventListener('input', (e) => {
              // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤–æ–ø—Ä–æ—Å–∞ (EN) ‚Äî –æ—Ç–º–µ—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
              markUnsaved();
              const val = e.target.value;
              field.labels = field.labels || {ru:'', en:''};
              field.labels.en = val;
              // Update preview and JSON only, avoid full rerender to maintain focus
              renderPreview();
              updateJson();
            });
            enInput.addEventListener('blur', () => {
              rerenderAll();
            });
            labelWrapper.appendChild(ruLabel);
            labelWrapper.appendChild(ruInput);
            // EN-–ø–æ–ª–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø–æ–ª–Ω–æ–º —Ä–µ–∂–∏–º–µ –∏ –µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω —Ñ–ª–∞–≥ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            if (viewMode === 'full' && showEnglishLabels) {
              labelWrapper.appendChild(enLabel);
              labelWrapper.appendChild(enInput);
            }
            // Type
            const typeWrapper = document.createElement('div');
            const typeLab = document.createElement('label');
            typeLab.textContent = '–¢–∏–ø –ø–æ–ª—è';
            const typeSel = document.createElement('select');
            FIELD_TYPES.forEach((t) => {
              const opt = document.createElement('option');
              opt.value = t;
              opt.textContent = t;
              if (field.type === t) opt.selected = true;
              typeSel.appendChild(opt);
            });
            typeSel.addEventListener('change', (e) => {
              // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø–æ–ª—è —è–≤–ª—è–µ—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
              markUnsaved();
              const val = e.target.value;
              field.type = val;
              // –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–∏–ø–∞ –æ—á–∏—â–∞–µ–º –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
              if (val !== 'number') {
                field.validation.min = '';
                field.validation.max = '';
                field.validation.step = '';
              }
              if (val !== 'text') {
                field.validation.pattern = '';
                field.validation.format = '';
              }
              // –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞, –ø—Ä–µ–≤—å—é –∏ JSON
              rerenderAll();
            });
            typeWrapper.appendChild(typeLab);
            typeWrapper.appendChild(typeSel);
            // Actions
            const actions = document.createElement('div');
            actions.style.display = 'flex';
            actions.style.gap = '2px';
            // Up field
            const upF = document.createElement('button');
            upF.type = 'button';
            upF.className = 'btn small';
            upF.textContent = '‚Üë';
            if (fIdx === 0) upF.disabled = true;
            upF.addEventListener('click', () => {
              if (fIdx > 0) {
                const tmp = section.fields[fIdx];
                section.fields[fIdx] = section.fields[fIdx - 1];
                section.fields[fIdx - 1] = tmp;
                // –ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª—è –∏–∑–º–µ–Ω—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é ‚Äî –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
                markUnsaved();
                rerenderAll();
              }
            });
            actions.appendChild(upF);
            // Down field
            const downF = document.createElement('button');
            downF.type = 'button';
            downF.className = 'btn small';
            downF.textContent = '‚Üì';
            if (fIdx >= section.fields.length - 1) downF.disabled = true;
            downF.addEventListener('click', () => {
              if (fIdx < section.fields.length - 1) {
                const tmp = section.fields[fIdx];
                section.fields[fIdx] = section.fields[fIdx + 1];
                section.fields[fIdx + 1] = tmp;
                // –ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª—è –∏–∑–º–µ–Ω—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é ‚Äî –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
                markUnsaved();
                rerenderAll();
              }
            });
            actions.appendChild(downF);
            // Duplicate field
            const dupF = document.createElement('button');
            dupF.type = 'button';
            dupF.className = 'btn small';
            dupF.textContent = '‚ßâ';
            dupF.title = '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–µ';
            dupF.addEventListener('click', () => {
              const copy = JSON.parse(JSON.stringify(field));
              copy.id = 'f_' + (fieldCounter++);
              if (copy.name) copy.name = copy.name + '_copy';
              section.fields.splice(fIdx + 1, 0, copy);
              // –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—è –∏–∑–º–µ–Ω—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é ‚Äî –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
              markUnsaved();
              rerenderAll();
            });
            actions.appendChild(dupF);
            // Remove field
            const remF = document.createElement('button');
            remF.type = 'button';
            remF.className = 'btn small danger';
            remF.textContent = '‚úï';
            remF.title = '–£–¥–∞–ª–∏—Ç—å –ø–æ–ª–µ';
            remF.addEventListener('click', () => {
              removeField(sIdx, fIdx);
            });
            actions.appendChild(remF);
            row.appendChild(labelWrapper);
            row.appendChild(typeWrapper);
            row.appendChild(actions);
            // row –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –±–∞–∑–æ–≤—ã–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º
            basic.appendChild(row);
            // Meta row: key + required
            const metaRow = document.createElement('div');
            metaRow.className = 'field-row';
            const keyWrapper = document.createElement('div');
            const keyLab = document.createElement('label');
            // –ë–æ–ª–µ–µ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∏–º–µ–Ω–∏
            keyLab.textContent = '–°–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, –ª–∞—Ç–∏–Ω–∏—Ü–∞)';
            const keyInput = document.createElement('input');
            keyInput.type = 'text';
            keyInput.value = field.name;
            keyInput.placeholder = '–ù–∞–ø—Ä–∏–º–µ—Ä: ram_size, screen_diagonal';
            keyInput.addEventListener('input', (e) => {
              // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∏–º–µ–Ω–∏ ‚Äî –æ—Ç–º–µ—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
              markUnsaved();
              field.name = e.target.value.trim();
              // Lightweight update: update preview and JSON
              updateJson();
              renderPreview();
            });
            // On blur, recompute duplicates and rerender builder
            keyInput.addEventListener('blur', () => {
              rerenderAll();
            });
            keyWrapper.appendChild(keyLab);
            keyWrapper.appendChild(keyInput);
            const keyHint = document.createElement('small');
            keyHint.className = 'note';
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É: –æ–±—ä—è—Å–Ω—è–µ–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∏–º–µ–Ω–∏ –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º
            keyHint.textContent = '–ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª–µ –ø—É—Å—Ç—ã–º, —Å–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –î–æ–ø—É—Å–∫–∞—é—Ç—Å—è –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏—è.';
            if (viewMode === 'full') {
              keyWrapper.appendChild(keyHint);
            }
            const reqWrapper = document.createElement('div');
            const reqLab = document.createElement('label');
            reqLab.textContent = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ?';
            const reqCheckbox = document.createElement('input');
            reqCheckbox.type = 'checkbox';
            reqCheckbox.checked = !!field.required;
            reqCheckbox.addEventListener('change', (e) => {
              // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ ‚Äî –æ—Ç–º–µ—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
              markUnsaved();
              field.required = e.target.checked;
              renderPreview();
              updateJson();
            });
            reqWrapper.appendChild(reqLab);
            reqWrapper.appendChild(reqCheckbox);
            const placeholderDiv = document.createElement('div');
            metaRow.appendChild(keyWrapper);
            metaRow.appendChild(reqWrapper);
            metaRow.appendChild(placeholderDiv);
            // metaRow –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –±–∞–∑–æ–≤—ã–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º
            basic.appendChild(metaRow);
            // –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
            if (problemMap[sIdx] && problemMap[sIdx][fIdx]) {
              const msgs = [];
              problemMap[sIdx][fIdx].forEach(code => {
                if (code === 'noName') msgs.push('–ù–µ —É–∫–∞–∑–∞–Ω–æ —Å–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è –ø–æ–ª—è');
                if (code === 'noLabel') msgs.push('–ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ (—á—Ç–æ —É–≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)');
                if (code === 'noOptions') msgs.push('–î–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ –ø–æ–ª—è –Ω—É–∂–Ω—ã –≤–∞—Ä–∏–∞–Ω—Ç—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é');
                if (code === 'duplicate') msgs.push('–¢–∞–∫–æ–µ —Å–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –¥—Ä—É–≥–æ–º –ø–æ–ª–µ');
                if (code === 'badPattern') msgs.push('–û—à–∏–±–∫–∞ –≤ —à–∞–±–ª–æ–Ω–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (pattern)');
                if (code === 'badKeyFormat') msgs.push('–°–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ª–∞—Ç–∏–Ω–∏—Ü–µ–π –∏ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å –±—É–∫–≤—ã');
              });
              if (msgs.length > 0) {
                const errDiv = document.createElement('div');
                errDiv.className = 'error-msg';
                errDiv.innerHTML = msgs.join('<br>');
                // –æ—à–∏–±–∫–∏ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –±–∞–∑–æ–≤—ã–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º
                basic.appendChild(errDiv);
              }
            }
            // Hint/description
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
            if (viewMode === 'full' && builderMode === 'advanced') {
              const hintDiv = document.createElement('div');
              hintDiv.className = 'options-input';
              const hLab = document.createElement('label');
              hLab.textContent = '–ü–æ–¥—Å–∫–∞–∑–∫–∞ / –æ–ø–∏—Å–∞–Ω–∏–µ';
              const hInput = document.createElement('textarea');
              hInput.value = field.hint || '';
              hInput.placeholder = '–ù–∞–ø—Ä–∏–º–µ—Ä: –£–∫–∞–∂–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –≥–∏–≥–∞–±–∞–π—Ç–∞—Ö, —Ç–æ–ª—å–∫–æ —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞.';
              hInput.addEventListener('input', (e) => {
                // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ ‚Äî –æ—Ç–º–µ—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
                markUnsaved();
                field.hint = e.target.value;
                renderPreview();
                updateJson();
              });
              hintDiv.appendChild(hLab);
              hintDiv.appendChild(hInput);
              // –ø–æ–¥—Å–∫–∞–∑–∫–∞ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º
              advanced.appendChild(hintDiv);
            }
            // Options for select/radio/multiselect
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤—ã–±–æ—Ä–∞ —Ç–æ–ª—å–∫–æ –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ
            if (builderMode === 'advanced' && OPTIONS_TYPES.includes(field.type)) {
              const optDiv = document.createElement('div');
              optDiv.className = 'options-input';
              const optLab = document.createElement('label');
              optLab.textContent = '–í–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è ' + field.type;
              const optInput = document.createElement('input');
              optInput.type = 'text';
              optInput.value = field.options || '';
              optInput.placeholder = '–í–∞—Ä–∏–∞–Ω—Ç—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é: Plastic, Aluminum, Magnesium';
              optInput.addEventListener('input', (e) => {
                // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ ‚Äî –æ—Ç–º–µ—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
                markUnsaved();
                field.options = e.target.value;
                // Update preview and JSON only while typing to maintain focus
                renderPreview();
                updateJson();
              });
              // On blur, rerender builder to recalculate errors
              optInput.addEventListener('blur', () => {
                rerenderAll();
              });
              const optHint = document.createElement('small');
              optHint.textContent = '–≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –≤ –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö –≤—ã–±–æ—Ä–∞.';
              if (viewMode === 'full') {
                optDiv.appendChild(optLab);
                optDiv.appendChild(optInput);
                optDiv.appendChild(optHint);
                // –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º
                advanced.appendChild(optDiv);
              }
            }
            // Number validation
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á–∏—Å–ª–æ–≤—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ
            if (field.type === 'number' && viewMode === 'full' && builderMode === 'advanced') {
              const valDiv = document.createElement('div');
              valDiv.className = 'options-input';
              const vLab = document.createElement('label');
              vLab.textContent = '–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è —á–∏—Å–ª–∞ (min / max / step)';
              valDiv.appendChild(vLab);
              const inner = document.createElement('div');
              inner.style.display = 'grid';
              inner.style.gridTemplateColumns = 'repeat(3, minmax(0, 1fr))';
              inner.style.gap = '4px';
              const minIn = document.createElement('input');
              minIn.type = 'number';
              minIn.placeholder = 'min';
              minIn.value = field.validation.min || '';
              minIn.addEventListener('input', (e) => {
                // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî –æ—Ç–º–µ—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
                markUnsaved();
                field.validation.min = e.target.value;
                renderPreview();
                updateJson();
              });
              const maxIn = document.createElement('input');
              maxIn.type = 'number';
              maxIn.placeholder = 'max';
              maxIn.value = field.validation.max || '';
              maxIn.addEventListener('input', (e) => {
                // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî –æ—Ç–º–µ—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
                markUnsaved();
                field.validation.max = e.target.value;
                renderPreview();
                updateJson();
              });
              const stepIn = document.createElement('input');
              stepIn.type = 'number';
              stepIn.placeholder = 'step';
              stepIn.value = field.validation.step || '';
              stepIn.addEventListener('input', (e) => {
                // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —à–∞–≥–∞ ‚Äî –æ—Ç–º–µ—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
                markUnsaved();
                field.validation.step = e.target.value;
                renderPreview();
                updateJson();
              });
              inner.appendChild(minIn);
              inner.appendChild(maxIn);
              inner.appendChild(stepIn);
              valDiv.appendChild(inner);
              const vHint = document.createElement('small');
              vHint.textContent = '–û—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–µ –Ω—É–∂–Ω–æ.';
              valDiv.appendChild(vHint);
              // –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–∏—Å–ª–∞ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º
              advanced.appendChild(valDiv);
            }
            // Text validation
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ
            if (field.type === 'text' && viewMode === 'full' && builderMode === 'advanced') {
              const valDiv = document.createElement('div');
              valDiv.className = 'options-input';
              const vLab = document.createElement('label');
              vLab.textContent = '–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è —Ç–µ–∫—Å—Ç–∞ (pattern / —Ñ–æ—Ä–º–∞—Ç)';
              valDiv.appendChild(vLab);
              const inner = document.createElement('div');
              inner.style.display = 'grid';
              inner.style.gridTemplateColumns = 'minmax(0, 1.3fr) minmax(0, 0.7fr)';
              inner.style.gap = '4px';
              const pattIn = document.createElement('input');
              pattIn.type = 'text';
              pattIn.placeholder = '–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (pattern)';
              pattIn.value = field.validation.pattern || '';
              pattIn.addEventListener('input', (e) => {
                // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ ‚Äî –æ—Ç–º–µ—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
                markUnsaved();
                field.validation.pattern = e.target.value;
                // While typing pattern, just update preview and JSON
                renderPreview();
                updateJson();
              });
              // On blur, rerender builder to validate regex
              pattIn.addEventListener('blur', () => {
                rerenderAll();
              });
              const fmtSel = document.createElement('select');
              ['', 'email', 'url'].forEach((fmt) => {
                const o = document.createElement('option');
                o.value = fmt;
                o.textContent = fmt === '' ? '–æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç' : fmt;
                if (field.validation.format === fmt) o.selected = true;
                fmtSel.appendChild(o);
              });
              fmtSel.addEventListener('change', (e) => {
                // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–µ–∫—Å—Ç–∞ ‚Äî –æ—Ç–º–µ—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
                markUnsaved();
                field.validation.format = e.target.value;
                renderPreview();
                updateJson();
              });
              inner.appendChild(pattIn);
              inner.appendChild(fmtSel);
              valDiv.appendChild(inner);
              const hintTxt = document.createElement('small');
              hintTxt.textContent = 'pattern ‚Äî –∫–∞—Å—Ç–æ–º–Ω–∞—è –º–∞—Å–∫–∞, —Ñ–æ—Ä–º–∞—Ç email/url –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –¥–æ–ø. –ø—Ä–æ–≤–µ—Ä–∫–∏.';
              valDiv.appendChild(hintTxt);
              // —Ç–µ–∫—Å—Ç–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º
              advanced.appendChild(valDiv);
            }
            // –í—Å—Ç–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤—ã–µ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–ª—è
            fieldDiv.appendChild(basic);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤–æ–æ–±—â–µ —á—Ç–æ-—Ç–æ –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
            const hasAdvancedContent = advanced.children.length > 0;

            if (viewMode === 'full' && builderMode === 'advanced' && hasAdvancedContent) {
              // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
              const toggleRow = document.createElement('div');
              toggleRow.className = 'note';

              const toggleBtn = document.createElement('button');
              toggleBtn.type = 'button';
              toggleBtn.className = 'btn small';
              toggleBtn.textContent = field.showAdvanced
                ? '–°–∫—Ä—ã—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏'
                : '‚öô¬†–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏';

              toggleBtn.addEventListener('click', () => {
                field.showAdvanced = !field.showAdvanced;
                rerenderAll();
              });

              toggleRow.appendChild(toggleBtn);
              fieldDiv.appendChild(toggleRow);
              fieldDiv.appendChild(advanced);
            }

            sectionDiv.appendChild(fieldDiv);
          });
          container.appendChild(sectionDiv);
        });
        // –ü—É—Å—Ç–æ–π –∫–æ–Ω—Ñ–∏–≥
        if (config.length === 0) {
          const emptyHint = document.createElement('div');
          emptyHint.className = 'note';
          emptyHint.textContent = '–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞. –ù–∞–∂–º–∏—Ç–µ ¬´+ –†–∞–∑–¥–µ–ª¬ª, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.';
          container.appendChild(emptyHint);
        }
        // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –¥—É–±–ª—è—Ö
        const existingWarn = document.getElementById('duplicateWarning');
        if (existingWarn) existingWarn.remove();
        if (Object.keys(validation.duplicates).length > 0) {
          const warn = document.createElement('div');
          warn.id = 'duplicateWarning';
          warn.className = 'note';
          warn.style.color = '#b91c1c';
          const dups = Object.entries(validation.duplicates).map(([k, cnt]) => `${k} (${cnt})`);
          warn.textContent = '–î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è key: ' + dups.join(', ');
          container.prepend(warn);
        }
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–µ–≤—å—é
      function renderPreview() {
        const form = document.getElementById('previewForm');
        form.innerHTML = '';
        if (config.length === 0) {
          form.innerHTML = "<p class='note'>–§–æ—Ä–º–∞ –µ—â—ë –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ —Ä–∞–∑–¥–µ–ª—ã –∏ –≤–æ–ø—Ä–æ—Å—ã —Å–ª–µ–≤–∞.</p>";
          return;
        }
        // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º —Å—Ö–µ–º—ã ‚Äì –≤—ã–≤–æ–¥–∏–º –∫—Ä–∞—Ç–∫—É—é —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é –≤–º–µ—Å—Ç–æ —Ñ–æ—Ä–º—ã
        if (previewMode === 'schema') {
          config.forEach((section) => {
            if (section.fields.length === 0) return;
            const secDiv = document.createElement('div');
            secDiv.className = 'schema-section';
            const secTitle = document.createElement('h4');
            secTitle.textContent = section.title || '';
            secDiv.appendChild(secTitle);
            section.fields.forEach((field) => {
              const row = document.createElement('div');
              row.className = 'schema-row';
              // fallback label: –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫, –∑–∞—Ç–µ–º RU, –∑–∞—Ç–µ–º name/id
              let lbl = '';
              if (field.labels && field.labels[previewLang] && field.labels[previewLang].trim()) {
                lbl = field.labels[previewLang].trim();
              } else if (field.labels && field.labels.ru && field.labels.ru.trim()) {
                lbl = field.labels.ru.trim();
              } else if (field.name) {
                lbl = field.name;
              } else {
                lbl = field.id;
              }
              const parts = [];
              parts.push((field.name || ''));
              parts.push(field.type);
              parts.push(field.required ? '–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ' : '–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ');
              if (OPTIONS_TYPES.includes(field.type)) {
                const opts = parseOptions(field.options);
                if (opts.length) {
                  parts.push('options=' + opts.join(', '));
                }
              }
              const validations = [];
              if (field.type === 'number') {
                if (field.validation.min) validations.push('min=' + field.validation.min);
                if (field.validation.max) validations.push('max=' + field.validation.max);
                if (field.validation.step) validations.push('step=' + field.validation.step);
              }
              if (field.type === 'text') {
                if (field.validation.pattern) validations.push('pattern=' + field.validation.pattern);
                if (field.validation.format) validations.push('format=' + field.validation.format);
              }
              if (validations.length) {
                parts.push(validations.join(' '));
              }
              if (field.hint) {
                parts.push(field.hint);
              }
              row.textContent = `${lbl} ‚Üí ${parts.join(' | ')}`;
              secDiv.appendChild(row);
            });
            form.appendChild(secDiv);
          });
          return;
        }
        // –ò–Ω–∞—á–µ –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º —Ñ–æ—Ä–º—ã
        config.forEach((section) => {
          if (section.fields.length === 0) return;
          const fieldset = document.createElement('fieldset');
          const legend = document.createElement('legend');
          legend.textContent = section.title || '';
          fieldset.appendChild(legend);
          section.fields.forEach((field) => {
            const wrapper = document.createElement('div');
            wrapper.className = 'preview-field';
            const inputId = (field.name && field.name.trim()) || field.id;
            const labelEl = document.createElement('label');
            let labelTxt = '';
            // fallback: prefer selected language, then RU, then name
            if (field.labels && field.labels[previewLang] && field.labels[previewLang].trim()) {
              labelTxt = field.labels[previewLang].trim();
            } else if (field.labels && field.labels.ru && field.labels.ru.trim()) {
              labelTxt = field.labels.ru.trim();
            } else if (field.name) {
              labelTxt = field.name;
            }
            if (field.required) labelTxt += ' *';
            labelEl.setAttribute('for', inputId);
            labelEl.textContent = labelTxt;
            let control;
            if (field.type === 'number') {
              control = document.createElement('input');
              control.type = 'number';
              if (field.validation.min !== '') control.min = field.validation.min;
              if (field.validation.max !== '') control.max = field.validation.max;
              if (field.validation.step !== '') control.step = field.validation.step;
            } else if (field.type === 'select') {
              control = document.createElement('select');
              const opts = parseOptions(field.options);
              const emptyOpt = document.createElement('option');
              emptyOpt.value = '';
              emptyOpt.textContent = '‚Äî –≤—ã–±—Ä–∞—Ç—å ‚Äî';
              control.appendChild(emptyOpt);
              opts.forEach((ov) => {
                const o = document.createElement('option');
                o.value = ov;
                o.textContent = ov;
                control.appendChild(o);
              });
            } else if (field.type === 'checkbox') {
              control = document.createElement('input');
              control.type = 'checkbox';
            } else if (field.type === 'radio') {
              control = document.createElement('div');
              const opts = parseOptions(field.options);
              opts.forEach((ov, idx) => {
                const lbl = document.createElement('label');
                lbl.style.display = 'inline-flex';
                lbl.style.alignItems = 'center';
                lbl.style.marginRight = '8px';
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = inputId;
                radio.value = ov;
                radio.id = inputId + '_' + idx;
                lbl.appendChild(radio);
                lbl.appendChild(document.createTextNode(' ' + ov));
                control.appendChild(lbl);
              });
            } else if (field.type === 'multiselect') {
              control = document.createElement('select');
              control.multiple = true;
              const opts = parseOptions(field.options);
              opts.forEach((ov) => {
                const o = document.createElement('option');
                o.value = ov;
                o.textContent = ov;
                control.appendChild(o);
              });
            } else if (field.type === 'textarea') {
              control = document.createElement('textarea');
            } else {
              control = document.createElement('input');
              let typeVal = 'text';
              if (field.validation.format === 'email') typeVal = 'email';
              if (field.validation.format === 'url') typeVal = 'url';
              control.type = typeVal;
              if (field.validation.pattern) control.pattern = field.validation.pattern;
            }
            control.id = inputId;
            control.name = inputId;
            if (field.required && field.type !== 'checkbox' && field.type !== 'radio') {
              control.required = true;
            }
            wrapper.appendChild(labelEl);
            wrapper.appendChild(control);
            if (field.hint) {
              const hintEl = document.createElement('div');
              hintEl.className = 'preview-hint';
              hintEl.textContent = field.hint;
              wrapper.appendChild(hintEl);
            }
            fieldset.appendChild(wrapper);
          });
          form.appendChild(fieldset);
        });
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ JSON –≤—ã–≤–æ–¥–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
      function updateJson() {
        const out = document.getElementById('jsonOutput');
        out.value = JSON.stringify(config, null, 2);
        try {
          localStorage.setItem('formBuilderConfig', out.value);
        } catch (e) {}
        // –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è JSON –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ
        updateLintTabIndicator();
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ JSON –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:
        // –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ ¬´–ù–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ¬ª, –ø–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        // —è–≤–Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç/—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ–µ–∫—Ç —á–µ—Ä–µ–∑ UI –∏–ª–∏ –≥–æ—Ä—è—á—É—é –∫–ª–∞–≤–∏—à—É.
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤
      document.getElementById('addSectionBtn').addEventListener('click', addSection);
      document.getElementById('showErrorsCheckbox').addEventListener('change', (e) => {
        showOnlyErrors = e.target.checked;
        renderBuilder();
        renderSectionNav();
        renderLintPanel();
      });
      document.getElementById('viewModeSelect').addEventListener('change', (e) => {
        viewMode = e.target.value;
        renderBuilder();
        renderSectionNav();
        renderLintPanel();
      });
      // –£–¥–∞–ª—ë–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —è–∑—ã–∫–∞ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ: —è–∑—ã–∫ –º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–æ –≤–∫–ª–∞–¥–∫–µ ¬´–ü—Ä–µ–≤—å—é¬ª

      // –í—ã–±–æ—Ä —è–∑—ã–∫–∞ –ø—Ä–µ–≤—å—é –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ ¬´–ü—Ä–µ–≤—å—é/–≠–∫—Å–ø–æ—Ä—Ç¬ª
      const previewLangSelectPreviewEl = document.getElementById('previewLangSelectPreview');
      if (previewLangSelectPreviewEl) {
        previewLangSelectPreviewEl.addEventListener('change', (e) => {
          previewLang = e.target.value;
          // –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
          renderPreview();
          const langLabel = document.getElementById('currentPreviewLang');
          if (langLabel) langLabel.textContent = previewLang.toUpperCase();
        });
      }
      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –ø—Ä–µ–≤—å—é: —Ñ–æ—Ä–º–∞ –∏–ª–∏ —Å—Ö–µ–º–∞
      const previewModeSelectEl = document.getElementById('previewModeSelect');
      if (previewModeSelectEl) {
        previewModeSelectEl.addEventListener('change', (e) => {
          previewMode = e.target.value;
          renderPreview();
        });
      }

      // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è EN-–ø–µ—Ä–µ–≤–æ–¥–æ–≤
      const toggleEnglishEl = document.getElementById('toggleEnglishLabels');
      if (toggleEnglishEl) {
        toggleEnglishEl.addEventListener('change', (e) => {
          showEnglishLabels = e.target.checked;
          // –ø—Ä–∏ —Å–º–µ–Ω–µ EN‚Äë–ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –±–∏–ª–¥–µ—Ä –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—é
          renderBuilder();
          renderSectionNav();
        });
      }

      // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —É—Ä–æ–≤–Ω—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ (–ø—Ä–æ—Å—Ç–æ–π/—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π)
      const builderModeSelectEl = document.getElementById('builderModeSelect');
      if (builderModeSelectEl) {
        builderModeSelectEl.addEventListener('change', (e) => {
          builderMode = e.target.value;
          // –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–µ–∂–∏–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –±–∏–ª–¥–µ—Ä
          renderBuilder();
          renderSectionNav();
        });
        // —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–ª–µ–∫—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–µ–∫—É—â–∏–º —Ä–µ–∂–∏–º–æ–º –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        builderModeSelectEl.value = builderMode;
      }

      // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è JSON –≤—Ä—É—á–Ω—É—é
      const enableJsonEditCheckbox = document.getElementById('enableJsonEdit');
      if (enableJsonEditCheckbox) {
        enableJsonEditCheckbox.addEventListener('change', (e) => {
          const out = document.getElementById('jsonOutput');
          if (out) {
            out.readOnly = !e.target.checked;
          }
        });
      }
      document.getElementById('clearPreviewBtn').addEventListener('click', () => {
        const form = document.getElementById('previewForm');
        const inputs = form.querySelectorAll('input, textarea, select');
        inputs.forEach(el => {
          if (el.type === 'checkbox' || el.type === 'radio') {
            el.checked = false;
          } else if (el.tagName.toLowerCase() === 'select') {
            if (el.multiple) {
              for (let i = 0; i < el.options.length; i++) {
                el.options[i].selected = false;
              }
            } else {
              el.selectedIndex = 0;
            }
          } else {
            el.value = '';
          }
        });
        // –ü—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —Ñ–æ—Ä–º—ã —Å–∫—Ä—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç—ã –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
        const ansPlaceholder = document.getElementById('answersPlaceholder');
        const ansOut = document.getElementById('answersOutput');
        if (ansPlaceholder) ansPlaceholder.style.display = 'block';
        if (ansOut) ansOut.style.display = 'none';
      });
      document.getElementById('buildAnswersBtn').addEventListener('click', () => {
        // –ü–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π –æ—Ç–≤–µ—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª–µ–π –±–µ–∑ key
        const validation = validateConfig();
        const hasNoName = validation.problems.some(p => p.errors && p.errors.includes('noName'));
        if (hasNoName) {
          if (!confirm('–ï—Å—Ç—å –ø–æ–ª—è –±–µ–∑ key, –æ—Ç–≤–µ—Ç—ã –ø–æ –Ω–∏–º –±—É–¥—É—Ç –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ id. –•–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
            return;
          }
        }
        const answers = {};
        const form = document.getElementById('previewForm');
        config.forEach((section) => {
          section.fields.forEach((field) => {
            const inputId = (field.name && field.name.trim()) || field.id;
            const el = form.querySelector(`[name='${inputId}']`);
            if (!el) return;
            let val = '';
            if (field.type === 'checkbox') {
              val = el.checked;
            } else if (field.type === 'radio') {
              const chk = form.querySelector(`input[name='${inputId}']:checked`);
              val = chk ? chk.value : '';
            } else if (field.type === 'multiselect') {
              val = Array.from(el.selectedOptions).map(o => o.value);
            } else {
              val = el.value;
            }
            answers[field.name || inputId] = val;
          });
        });
        const ansPlaceholder = document.getElementById('answersPlaceholder');
        const ansOut = document.getElementById('answersOutput');
        // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
        if (ansPlaceholder) ansPlaceholder.style.display = 'none';
        if (ansOut) {
          ansOut.style.display = 'block';
          ansOut.value = JSON.stringify(answers, null, 2);
        }
      });
      document.getElementById('downloadJsonBtn').addEventListener('click', () => {
        // –ü–µ—Ä–µ–¥ —ç–∫—Å–ø–æ—Ä—Ç–æ–º —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ localStorage –∏ –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ
        updateJson();
        markSaved();
        const blob = new Blob([JSON.stringify(config, null, 2)], {type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'config.json';
        document.body.appendChild(a);
        a.click();
        setTimeout(() => {
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }, 0);
      });
      document.getElementById('uploadJsonBtn').addEventListener('click', () => {
        document.getElementById('uploadJsonFile').click();
      });
      document.getElementById('uploadJsonFile').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(ev) {
          try {
            const data = JSON.parse(ev.target.result);
            if (Array.isArray(data)) {
              // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –µ—ë –∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫–∏
              // –û—Ç–º–µ—á–∞–µ–º –ø—Ä–æ–µ–∫—Ç –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—É—é —Å—Ö–µ–º—É
              markUnsaved();
              config = data;
              normalizeConfig(config);
              // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º JSON –≤ localStorage
              rerenderAll();
            } else {
              alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON');
            }
          } catch (err) {
            alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞');
          }
        };
        reader.readAsText(file);
      });
      document.getElementById('loadTemplateBtn').addEventListener('click', () => {
        // –ó–∞–≥—Ä—É–∑–∫–∞ –≥–æ—Ç–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ –Ω–æ—É—Ç–±—É–∫–∞
        // –ü–æ–º–µ—á–∞–µ–º —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é, —Ç.–∫. –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        // –ø–æ–¥–º–µ–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç –Ω–æ–≤—ã–º —à–∞–±–ª–æ–Ω–æ–º
        markUnsaved();
        config = loadLaptopTemplate();
        // loadLaptopTemplate —É–∂–µ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—á—ë—Ç—á–∏–∫–∏
        rerenderAll();
      });

      // –°–±—Ä–æ—Å–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: –æ—á–∏—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏ —Å–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç–æ–π —Ä–∞–∑–¥–µ–ª
      const resetBtn = document.getElementById('resetConfigBtn');
      if (resetBtn) {
        resetBtn.addEventListener('click', () => {
          if (!confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã –∏ –æ—á–∏—Å—Ç–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é?')) return;
          config = [];
          localStorage.removeItem('formBuilderConfig');
          sectionCounter = 1;
          fieldCounter = 1;
          addSection();
          rerenderAll();
        });
      }
      // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
      const navToggleBtn = document.getElementById('toggleNavBtn');
      if (navToggleBtn) {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        (function initNavToggle() {
          const nav = document.getElementById('sectionNav');
          if (!nav) return;
          navToggleBtn.textContent = nav.classList.contains('hidden')
            ? 'üìÇ –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é'
            : 'üìÇ –°–∫—Ä—ã—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é';
        })();
        navToggleBtn.addEventListener('click', () => {
          const nav = document.getElementById('sectionNav');
          if (!nav) return;
          const isHidden = nav.classList.toggle('hidden');
          navToggleBtn.textContent = isHidden
            ? 'üìÇ –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é'
            : 'üìÇ –°–∫—Ä—ã—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é';
        });
      }

      // –ö–Ω–æ–ø–∫–∏ –≤ —à–∞–ø–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      const loadTemplateBtnHeaderEl = document.getElementById('loadTemplateBtnHeader');
      if (loadTemplateBtnHeaderEl) {
        loadTemplateBtnHeaderEl.addEventListener('click', () => {
          const orig = document.getElementById('loadTemplateBtn');
          if (orig) orig.click();
        });
      }
      const resetConfigBtnHeaderEl = document.getElementById('resetConfigBtnHeader');
      if (resetConfigBtnHeaderEl) {
        resetConfigBtnHeaderEl.addEventListener('click', () => {
          const orig = document.getElementById('resetConfigBtn');
          if (orig) orig.click();
        });
      }
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —è–≤–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –≤ localStorage
      const saveProjectBtnEl = document.getElementById('saveProjectBtn');
      if (saveProjectBtnEl) {
        saveProjectBtnEl.addEventListener('click', () => {
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ localStorage
          updateJson();
          // –ü–æ–º–µ—á–∞–µ–º –ø—Ä–æ–µ–∫—Ç –∫–∞–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π
          markSaved();
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ –±—Ä–∞—É–∑–µ—Ä
          const statusEl = document.getElementById('saveStatus');
          if (statusEl) {
            const originalText = statusEl.textContent;
            statusEl.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ';
            // –ß–µ—Ä–µ–∑ –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç
            setTimeout(() => {
              statusEl.textContent = originalText;
            }, 2000);
          }
        });
      }
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Ñ–∞–π–ª JSON
      const exportProjectBtnEl = document.getElementById('exportProjectBtn');
      if (exportProjectBtnEl) {
        exportProjectBtnEl.addEventListener('click', () => {
          const orig = document.getElementById('downloadJsonBtn');
          if (orig) orig.click();
        });
      }
      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ JSON-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
      const jsonPanelBtn = document.getElementById('toggleJsonPanelBtn');
      if (jsonPanelBtn) {
        jsonPanelBtn.addEventListener('click', () => {
          const panel = document.getElementById('jsonPanel');
          if (panel) {
            panel.classList.toggle('collapsed');
          }
        });
      }

      // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ JSON
      const applyJsonBtnEl = document.getElementById('applyJsonBtn');
      if (applyJsonBtnEl) {
        applyJsonBtnEl.addEventListener('click', () => {
          // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
          if (!confirm('–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è JSON? –≠—Ç–æ –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –æ—Ç–º–µ—Ç–∏—Ç –ø—Ä–æ–µ–∫—Ç –∫–∞–∫ –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π.')) return;
          try {
            const textarea = document.getElementById('jsonOutput');
            if (!textarea) return;
            const data = JSON.parse(textarea.value);
            if (Array.isArray(data)) {
              // –ó–∞–º–µ–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–∞ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è
              config = data;
              // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ (labels, validation, showAdvanced) –∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º id
              normalizeConfig(config);
              // –û—Ç–º–µ—á–∞–µ–º, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –∏–∑–º–µ–Ω—ë–Ω –∏ —Ç—Ä–µ–±—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
              markUnsaved();
              // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –æ–±–Ω–æ–≤–ª—è–µ–º JSON
              rerenderAll();
            } else {
              alert('JSON –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∞—Å—Å–∏–≤ —Ä–∞–∑–¥–µ–ª–æ–≤.');
            }
          } catch (err) {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–±–æ—Ä–µ JSON. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞.');
          }
        });
      }

      // ====== –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –ø–∞–Ω–µ–ª—å –ø—Ä–æ–≤–µ—Ä–∫–∏ ======

      /**
       * –û—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º –≤ –ª–µ–≤–æ–º —Å–∞–π–¥–±–∞—Ä–µ.
       * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ —Ä—è–¥–æ–º —Å –∫–∞–∂–¥—ã–º —Ä–∞–∑–¥–µ–ª–æ–º.
       */
      function renderSectionNav() {
        const nav = document.getElementById('sectionNav');
        if (!nav) return;
        nav.innerHTML = '';
        const validation = validateConfig();
        const problemCounts = {};
        validation.problems.forEach((p) => {
          problemCounts[p.sIdx] = (problemCounts[p.sIdx] || 0) + 1;
        });
        // –í—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        const header = document.createElement('div');
        header.className = 'nav-header';
        const t = document.createElement('div');
        t.className = 'nav-title';
        t.textContent = '–†–∞–∑–¥–µ–ª—ã —Ñ–æ—Ä–º—ã';
        header.appendChild(t);
        const n = document.createElement('div');
        n.className = 'note';
        n.textContent = '–ö–ª–∏–∫ ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ä–∞–∑–¥–µ–ª—É, —á–∏—Å–ª–æ —Å–ø—Ä–∞–≤–∞ ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫';
        header.appendChild(n);
        nav.appendChild(header);
        config.forEach((section, sIdx) => {
          const item = document.createElement('div');
          item.className = 'nav-item';
          item.dataset.sectionIndex = sIdx;
          // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–¥–µ–ª
          if (currentSectionIndex !== null && sIdx === currentSectionIndex) {
            item.classList.add('current');
          }
          // –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª–µ–π
          const titleEl = document.createElement('div');
          titleEl.className = 'nav-item-title';
          const fieldsCount = section.fields.length;
          // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–∫–ª–æ–Ω–µ–Ω–∏–µ —Å–ª–æ–≤–∞ "–ø–æ–ª–µ"
          let word = '–ø–æ–ª–µ–π';
          const mod10 = fieldsCount % 10;
          const mod100 = fieldsCount % 100;
          if (mod10 === 1 && mod100 !== 11) word = '–ø–æ–ª–µ';
          else if (mod10 >= 2 && mod10 <= 4 && (mod100 < 10 || mod100 >= 20)) word = '–ø–æ–ª—è';
          // –ú–∞–ª–µ–Ω—å–∫–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—à–∏–±–æ–∫ —Å–ª–µ–≤–∞
          const cnt = problemCounts[sIdx] || 0;
          if (cnt > 0) {
            const dot = document.createElement('span');
            dot.className = 'error-dot';
            titleEl.appendChild(dot);
            item.classList.add('has-errors');
          }
          const titleText = document.createElement('span');
          titleText.textContent = (sIdx + 1) + '. ' + (section.title && section.title.trim() !== '' ? section.title : ('–†–∞–∑–¥–µ–ª ' + (sIdx + 1))) + ' ‚Ä¢ ' + fieldsCount + ' ' + word;
          titleEl.appendChild(titleText);
          item.appendChild(titleEl);
          // –ë–µ–π–¥–∂ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ—à–∏–±–æ–∫ —Å–ø—Ä–∞–≤–∞
          if (cnt > 0) {
            const badge = document.createElement('span');
            badge.className = 'error-count';
            badge.textContent = cnt;
            item.appendChild(badge);
          }
          item.addEventListener('click', () => {
            // –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ä–∞–∑–¥–µ–ª —Å–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É ¬´–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä¬ª, –∑–∞—Ç–µ–º —Å–∫—Ä–æ–ª–ª–∏–º –∫ —Ä–∞–∑–¥–µ–ª—É
            switchTab('constructor');
            scrollToSection(sIdx);
          });
          nav.appendChild(item);
        });
      }

      /**
       * –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ —Ä–∞–∑–¥–µ–ª—É –ø–æ –∏–Ω–¥–µ–∫—Å—É –∏ –∫–æ—Ä–æ—Ç–∫–æ –ø–æ–¥—Å–≤–µ—Ç–∏—Ç—å –µ–≥–æ.
       * @param {number} sIdx
       */
      function scrollToSection(sIdx) {
        const secEl = document.querySelector('.section-block[data-section-index="' + sIdx + '"]');
        if (secEl) {
          secEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
          secEl.classList.add('highlight');
          // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –≤–Ω–∏–º–∞–Ω–∏—è
          setTimeout(() => {
            secEl.classList.remove('highlight');
          }, 2000);
          // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–¥–µ–ª –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
          currentSectionIndex = sIdx;
          renderSectionNav();
        }
      }

      /**
       * –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø–æ–ª–µ –ø–æ –∏–Ω–¥–µ–∫—Å—É —Ä–∞–∑–¥–µ–ª–∞ –∏ –ø–æ–ª—è.
       * @param {number} sIdx
       * @param {number} fIdx
       */
      function scrollToField(sIdx, fIdx) {
        const field = config[sIdx] && config[sIdx].fields[fIdx];
        if (!field) return;
        // –ï—Å–ª–∏ —Å–µ–π—á–∞—Å schema-—Ä–µ–∂–∏–º, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –≤ full
        if (viewMode === 'schema') {
          viewMode = 'full';
          const viewSel = document.getElementById('viewModeSelect');
          if (viewSel) viewSel.value = 'full';
        }
        // –≤—Å–µ–≥–¥–∞ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ–º advanced, —á—Ç–æ–±—ã –ø–æ–ª–µ –±—ã–ª–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–∏–¥–Ω–æ
        if (!field.showAdvanced) {
          field.showAdvanced = true;
        }
        // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, —á—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ
        renderBuilder();
        setTimeout(() => {
          const fieldEl = document.querySelector('.field-block[data-field-id="' + field.id + '"]');
          if (fieldEl) {
            fieldEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
            fieldEl.classList.add('highlight');
            setTimeout(() => {
              fieldEl.classList.remove('highlight');
            }, 2000);
            currentSectionIndex = sIdx;
            renderSectionNav();
          }
        }, 0);
      }

      /**
       * –û—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –ø–∞–Ω–µ–ª—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (lint).
       */
      function renderLintPanel() {
        const lintEl = document.getElementById('lintList');
        if (!lintEl) return;
        lintEl.innerHTML = '';
        const validation = validateConfig();
        if (validation.problems.length === 0) {
          const ok = document.createElement('div');
          ok.textContent = '–û—à–∏–±–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ! –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞.';
          ok.style.color = '#15803d';
          lintEl.appendChild(ok);
          return;
        }
        // –°–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –ø–æ —Ä–∞–∑–¥–µ–ª—É –∏ –ø–æ–ª—é
        const grouped = {};
        validation.problems.forEach((p) => {
          const key = p.sIdx + '-' + p.fIdx;
          if (!grouped[key]) {
            grouped[key] = { sIdx: p.sIdx, fIdx: p.fIdx, errors: [] };
          }
          // –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫
          grouped[key].errors = grouped[key].errors.concat(p.errors);
        });
        Object.values(grouped).forEach((grp) => {
          const section = config[grp.sIdx];
          const field = (grp.fIdx !== null && grp.fIdx !== undefined && grp.fIdx !== 'null' && section.fields[grp.fIdx]) ? section.fields[grp.fIdx] : null;
          // –ü–æ–ª—É—á–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫: –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –∏ –ø–æ–ª—è
          const sectionTitle = section && section.title && section.title.trim() ? section.title : ('–†–∞–∑–¥–µ–ª ' + (grp.sIdx + 1));
          const fieldTitle = (field && field.labels && field.labels.ru && field.labels.ru.trim()) ? field.labels.ru.trim() : (field ? (field.name || field.id || '–ü–æ–ª–µ') : '');
          // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –∫–æ–¥—ã –æ—à–∏–±–æ–∫ –≤ –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
          const msgs = [];
          grp.errors.forEach((err) => {
            let msg = '';
            if (err === 'noName') msg = '–Ω–µ —É–∫–∞–∑–∞–Ω–æ —Å–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è –ø–æ–ª—è';
            if (err === 'noLabel') msg = '–Ω–µ—Ç —Ç–µ–∫—Å—Ç–∞ –≤–æ–ø—Ä–æ—Å–∞';
            if (err === 'noOptions') msg = '–Ω–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤';
            if (err === 'duplicate') msg = '–¥—É–±–ª–∏–∫–∞—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∏–º–µ–Ω–∏';
            if (err === 'badPattern') msg = '–æ—à–∏–±–∫–∞ –≤ —à–∞–±–ª–æ–Ω–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (pattern)';
            if (err === 'badKeyFormat') msg = '—Å–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ª–∞—Ç–∏–Ω–∏—Ü–µ–π –∏ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å –±—É–∫–≤—ã';
            if (err === 'emptySectionTitle') msg = '–Ω–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞';
            if (msg) msgs.push(msg);
          });
          const item = document.createElement('div');
          item.className = 'lint-item';
          // –§–æ—Ä–º–∏—Ä—É–µ–º HTML: –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫
          let header = '';
          if (field) {
            header = sectionTitle + ' ‚Üí ' + fieldTitle;
          } else {
            header = sectionTitle;
          }
          const listHtml = msgs.map(m => '<li>' + m + '</li>').join('');
          item.innerHTML = '<strong>' + header + '</strong>:<ul>' + listHtml + '</ul>';
          // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ
          item.addEventListener('click', () => {
            if (field) {
              scrollToField(grp.sIdx, grp.fIdx);
            } else {
              scrollToSection(grp.sIdx);
            }
            switchTab('constructor');
          });
          lintEl.appendChild(item);
        });
      }

      /**
       * –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤–∫–ª–∞–¥–∫—É –ø–æ –∏–º–µ–Ω–∏.
       * @param {string} tab
       */
      function switchTab(tab) {
        currentTab = tab;
        document.querySelectorAll('.tab').forEach((btn) => {
          btn.classList.remove('active');
          // –û–±–Ω–æ–≤–ª—è–µ–º aria-selected –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
          if (btn.dataset.tab === tab) {
            btn.classList.add('active');
            btn.setAttribute('aria-selected', 'true');
          } else {
            btn.setAttribute('aria-selected', 'false');
          }
        });
        document.querySelectorAll('.tab-content').forEach((p) => {
          p.classList.remove('active');
        });
        const page = document.getElementById(tab + 'Page');
        if (page) page.classList.add('active');
        // –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∫–ª–∞–¥–∫–∏
        if (tab === 'constructor') {
          renderBuilder();
          renderSectionNav();
        }
        if (tab === 'lint') {
          renderLintPanel();
        }
        if (tab === 'preview') {
          renderPreview();
        }
        // –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã –≤–∫–ª–∞–¥–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—à–∏–±–æ–∫ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ ¬´–ü—Ä–æ–≤–µ—Ä–∫–∞¬ª
        updateLintTabIndicator();
      }

      // –ù–∞–∑–Ω–∞—á–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–∫–ª–∞–¥–æ–∫
      document.querySelectorAll('.tab').forEach((btn) => {
        btn.addEventListener('click', () => switchTab(btn.dataset.tab));
      });
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑ localStorage
      (function init() {
        try {
          const saved = localStorage.getItem('formBuilderConfig');
          if (saved) {
            config = JSON.parse(saved);
            // –ü—Ä–∏–≤–æ–¥–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º—É –≤–∏–¥—É –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫–∏
            normalizeConfig(config);
            rerenderAll();
            return;
          }
        } catch (e) {
          // –µ—Å–ª–∏ —á—Ç–µ–Ω–∏–µ –∏–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∏ —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª
        }
        // –ï—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ—Ç, –Ω–∞—á–∏–Ω–∞–µ–º —Å –æ–¥–Ω–æ–≥–æ –ø—É—Å—Ç–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
        addSection();
      })();

      // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
      // Ctrl/Cmd+S ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–æ–±–Ω–æ–≤–∏—Ç—å JSON –∏ localStorage),
      // Ctrl/Cmd+Enter ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª.
      document.addEventListener('keydown', (e) => {
        // Ctrl+S –∏–ª–∏ Cmd+S
        if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
          e.preventDefault();
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –ø–æ–º–µ—á–∞–µ–º –µ—ë –∫–∞–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é
          updateJson();
          markSaved();
        }
        // Ctrl+Enter –∏–ª–∏ Cmd+Enter
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
          e.preventDefault();
          addSection();
        }
      });
    })();
  </script>
</body>
</html>
